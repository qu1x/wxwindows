--- a/config.guess
+++ b/config.guess
@@ -1,7 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
-#   Copyright (C) 1992, 93, 94, 95, 1996 Free Software Foundation, Inc.
-#
+#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
+#   2000, 2001, 2002 Free Software Foundation, Inc.
+
+timestamp='2002-10-21'
+
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
@@ -21,69 +24,321 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Written by Per Bothner <bothner@cygnus.com>.
-# The master version of this file is at the FSF in /home/gd/gnu/lib.
+# Originally written by Per Bothner <per@bothner.com>.
+# Please send patches to <config-patches@gnu.org>.  Submit a context
+# diff and a properly formatted ChangeLog entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
 # The plan is that this can be called by configure scripts if you
-# don't specify an explicit system type (host/target name).
-#
-# Only a few systems have been added to this list; please add others
-# (but try to keep the structure clean).
-#
+# don't specify an explicit build system type.
+
+me=`echo "$0" | sed -e 's,.*/,,'`
+
+usage="\
+Usage: $0 [OPTION]
+
+Output the configuration name of the system \`$me' is run on.
+
+Operation modes:
+  -h, --help         print this help, then exit
+  -t, --time-stamp   print date of last modification, then exit
+  -v, --version      print version number, then exit
+
+Report bugs and patches to <config-patches@gnu.org>."
+
+version="\
+GNU config.guess ($timestamp)
+
+Originally written by Per Bothner.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+Free Software Foundation, Inc.
+
+This is free software; see the source for copying conditions.  There is NO
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
+
+help="
+Try \`$me --help' for more information."
+
+# Parse command line
+while test $# -gt 0 ; do
+  case $1 in
+    --time-stamp | --time* | -t )
+       echo "$timestamp" ; exit 0 ;;
+    --version | -v )
+       echo "$version" ; exit 0 ;;
+    --help | --h* | -h )
+       echo "$usage"; exit 0 ;;
+    -- )     # Stop option processing
+       shift; break ;;
+    - )	# Use stdin as input.
+       break ;;
+    -* )
+       echo "$me: invalid option $1$help" >&2
+       exit 1 ;;
+    * )
+       break ;;
+  esac
+done
+
+if test $# != 0; then
+  echo "$me: too many arguments$help" >&2
+  exit 1
+fi
+
+trap 'exit 1' 1 2 15
+
+# CC_FOR_BUILD -- compiler used by this script. Note that the use of a
+# compiler to aid in system detection is discouraged as it requires
+# temporary files to be created and, as you can see below, it is a
+# headache to deal with in a portable fashion.
+
+# Historically, `CC_FOR_BUILD' used to be named `HOST_CC'. We still
+# use `HOST_CC' if defined, but it is deprecated.
+
+# This shell variable is my proudest work .. or something. --bje
+
+set_cc_for_build='tmpdir=${TMPDIR-/tmp}/config-guess-$$ ;
+(old=`umask` && umask 077 && mkdir $tmpdir && umask $old && unset old)
+   || (echo "$me: cannot create $tmpdir" >&2 && exit 1) ;
+dummy=$tmpdir/dummy ;
+files="$dummy.c $dummy.o $dummy.rel $dummy" ;
+trap '"'"'rm -f $files; rmdir $tmpdir; exit 1'"'"' 1 2 15 ;
+case $CC_FOR_BUILD,$HOST_CC,$CC in
+ ,,)    echo "int x;" > $dummy.c ;
+	for c in cc gcc c89 c99 ; do
+	  if ($c -c -o $dummy.o $dummy.c) >/dev/null 2>&1 ; then
+	     CC_FOR_BUILD="$c"; break ;
+	  fi ;
+	done ;
+	rm -f $files ;
+	if test x"$CC_FOR_BUILD" = x ; then
+	  CC_FOR_BUILD=no_compiler_found ;
+	fi
+	;;
+ ,,*)   CC_FOR_BUILD=$CC ;;
+ ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
+esac ;
+unset files'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
-# (ghazi@noc.rutgers.edu 8/24/94.)
+# (ghazi@noc.rutgers.edu 1994-08-24)
 if (test -f /.attbin/uname) >/dev/null 2>&1 ; then
 	PATH=$PATH:/.attbin ; export PATH
 fi
 
 UNAME_MACHINE=`(uname -m) 2>/dev/null` || UNAME_MACHINE=unknown
 UNAME_RELEASE=`(uname -r) 2>/dev/null` || UNAME_RELEASE=unknown
-UNAME_SYSTEM=`(uname -s) 2>/dev/null` || UNAME_SYSTEM=unknown
+UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
 UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
 
-trap 'rm -f dummy.c dummy.o dummy; exit 1' 1 2 15
-
 # Note: order is significant - the case branches are not exclusive.
 
 case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
-    alpha:OSF1:[VX]*:*)
-	# After 1.2, OSF1 uses "V1.3" for uname -r.
-	# After 4.x, OSF1 uses "X4.x" for uname -r.
-	echo alpha-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VX]//'`
+    *:NetBSD:*:*)
+	# NetBSD (nbsd) targets should (where applicable) match one or
+	# more of the tupples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
+	# switched to ELF, *-*-netbsd* would select the old
+	# object file format.  This provides both forward
+	# compatibility and a consistent mechanism for selecting the
+	# object file format.
+	#
+	# Note: NetBSD doesn't particularly care about the vendor
+	# portion of the name.  We always set it to "unknown".
+	sysctl="sysctl -n hw.machine_arch"
+	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
+	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
+	case "${UNAME_MACHINE_ARCH}" in
+	    armeb) machine=armeb-unknown ;;
+	    arm*) machine=arm-unknown ;;
+	    sh3el) machine=shl-unknown ;;
+	    sh3eb) machine=sh-unknown ;;
+	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
+	esac
+	# The Operating System including object format, if it has switched
+	# to ELF recently, or will in the future.
+	case "${UNAME_MACHINE_ARCH}" in
+	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
+		eval $set_cc_for_build
+		if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
+			| grep __ELF__ >/dev/null
+		then
+		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
+		    # Return netbsd for either.  FIX?
+		    os=netbsd
+		else
+		    os=netbsdelf
+		fi
+		;;
+	    *)
+	        os=netbsd
+		;;
+	esac
+	# The OS release
+	release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
+	# contains redundant information, the shorter form:
+	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
+	echo "${machine}-${os}${release}"
+	exit 0 ;;
+    amiga:OpenBSD:*:*)
+	echo m68k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    arc:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    hp300:OpenBSD:*:*)
+	echo m68k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    mac68k:OpenBSD:*:*)
+	echo m68k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    macppc:OpenBSD:*:*)
+	echo powerpc-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    mvme68k:OpenBSD:*:*)
+	echo m68k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    mvme88k:OpenBSD:*:*)
+	echo m88k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    mvmeppc:OpenBSD:*:*)
+	echo powerpc-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    pmax:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    sgi:OpenBSD:*:*)
+	echo mipseb-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    sun3:OpenBSD:*:*)
+	echo m68k-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    wgrisc:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    *:OpenBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
     alpha:OSF1:*:*)
+	if test $UNAME_RELEASE = "V4.0"; then
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
+	fi
+	# A Vn.n version is a released version.
+	# A Tn.n version is a released field test version.
+	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
-	echo alpha-dec-osf${UNAME_RELEASE}
-        exit 0 ;;
+	eval $set_cc_for_build
+	cat <<EOF >$dummy.s
+	.data
+\$Lformat:
+	.byte 37,100,45,37,120,10,0	# "%d-%x\n"
+
+	.text
+	.globl main
+	.align 4
+	.ent main
+main:
+	.frame \$30,16,\$26,0
+	ldgp \$29,0(\$27)
+	.prologue 1
+	.long 0x47e03d80 # implver \$0
+	lda \$2,-1
+	.long 0x47e20c21 # amask \$2,\$1
+	lda \$16,\$Lformat
+	mov \$0,\$17
+	not \$1,\$18
+	jsr \$26,printf
+	ldgp \$29,0(\$26)
+	mov 0,\$16
+	jsr \$26,exit
+	.end main
+EOF
+	$CC_FOR_BUILD -o $dummy $dummy.s 2>/dev/null
+	if test "$?" = 0 ; then
+		case `$dummy` in
+			0-0)
+				UNAME_MACHINE="alpha"
+				;;
+			1-0)
+				UNAME_MACHINE="alphaev5"
+				;;
+			1-1)
+				UNAME_MACHINE="alphaev56"
+				;;
+			1-101)
+				UNAME_MACHINE="alphapca56"
+				;;
+			2-303)
+				UNAME_MACHINE="alphaev6"
+				;;
+			2-307)
+				UNAME_MACHINE="alphaev67"
+				;;
+			2-1307)
+				UNAME_MACHINE="alphaev68"
+				;;
+			3-1307)
+				UNAME_MACHINE="alphaev7"
+				;;
+		esac
+	fi
+	rm -f $dummy.s $dummy && rmdir $tmpdir
+	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	exit 0 ;;
+    Alpha\ *:Windows_NT*:*)
+	# How do we know it's Interix rather than the generic POSIX subsystem?
+	# Should we change UNAME_MACHINE based on the output of uname instead
+	# of the specific Alpha model?
+	echo alpha-pc-interix
+	exit 0 ;;
     21064:Windows_NT:50:3)
 	echo alpha-dec-winnt3.5
 	exit 0 ;;
     Amiga*:UNIX_System_V:4.0:*)
-	echo m68k-cbm-sysv4
+	echo m68k-unknown-sysv4
 	exit 0;;
-    amiga:NetBSD:*:*)
-      echo m68k-cbm-netbsd${UNAME_RELEASE}
-      exit 0 ;;
+    *:[Aa]miga[Oo][Ss]:*:*)
+	echo ${UNAME_MACHINE}-unknown-amigaos
+	exit 0 ;;
+    *:[Mm]orph[Oo][Ss]:*:*)
+	echo ${UNAME_MACHINE}-unknown-morphos
+	exit 0 ;;
+    *:OS/390:*:*)
+	echo i370-ibm-openedition
+	exit 0 ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
 	exit 0;;
-    Pyramid*:OSx*:*:*)
+    SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
+	echo hppa1.1-hitachi-hiuxmpp
+	exit 0;;
+    Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
+	# akee@wpdis03.wpafb.af.mil (Earle F. Ake) contributed MIS and NILE.
 	if test "`(/bin/universe) 2>/dev/null`" = att ; then
 		echo pyramid-pyramid-sysv3
 	else
 		echo pyramid-pyramid-bsd
 	fi
 	exit 0 ;;
-    sun4*:SunOS:5.*:*)
+    NILE*:*:*:dcosx)
+	echo pyramid-pyramid-svr4
+	exit 0 ;;
+    DRS?6000:UNIX_SV:4.2*:7*)
+	case `/usr/bin/uname -p` in
+	    sparc) echo sparc-icl-nx7 && exit 0 ;;
+	esac ;;
+    sun4H:SunOS:5.*:*)
+	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit 0 ;;
+    sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
     i86pc:SunOS:5.*:*)
-	echo i386-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
@@ -103,14 +358,52 @@
     sun3*:SunOS:*:*)
 	echo m68k-sun-sunos${UNAME_RELEASE}
 	exit 0 ;;
-    atari*:NetBSD:*:*)
-	echo m68k-atari-netbsd${UNAME_RELEASE}
+    sun*:*:4.2BSD:*)
+	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`
+	test "x${UNAME_RELEASE}" = "x" && UNAME_RELEASE=3
+	case "`/bin/arch`" in
+	    sun3)
+		echo m68k-sun-sunos${UNAME_RELEASE}
+		;;
+	    sun4)
+		echo sparc-sun-sunos${UNAME_RELEASE}
+		;;
+	esac
 	exit 0 ;;
-    sun3*:NetBSD:*:*)
-	echo m68k-sun-netbsd${UNAME_RELEASE}
+    aushp:SunOS:*:*)
+	echo sparc-auspex-sunos${UNAME_RELEASE}
 	exit 0 ;;
-    mac68k:NetBSD:*:*)
-	echo m68k-apple-netbsd${UNAME_RELEASE}
+    # The situation for MiNT is a little confusing.  The machine name
+    # can be virtually everything (everything which is not
+    # "atarist" or "atariste" at least should have a processor
+    # > m68000).  The system name ranges from "MiNT" over "FreeMiNT"
+    # to the lowercase version "mint" (or "freemint").  Finally
+    # the system name "TOS" denotes a system which is actually not
+    # MiNT.  But MiNT is downward compatible to TOS, so this should
+    # be no problem.
+    atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
+        echo m68k-atari-mint${UNAME_RELEASE}
+	exit 0 ;;
+    atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
+	echo m68k-atari-mint${UNAME_RELEASE}
+        exit 0 ;;
+    *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
+        echo m68k-atari-mint${UNAME_RELEASE}
+	exit 0 ;;
+    milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
+        echo m68k-milan-mint${UNAME_RELEASE}
+        exit 0 ;;
+    hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
+        echo m68k-hades-mint${UNAME_RELEASE}
+        exit 0 ;;
+    *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
+        echo m68k-unknown-mint${UNAME_RELEASE}
+        exit 0 ;;
+    powerpc:machten:*:*)
+	echo powerpc-apple-machten${UNAME_RELEASE}
+	exit 0 ;;
+    RISC*:Mach:*:*)
+	echo mips-dec-mach_bsd4.3
 	exit 0 ;;
     RISC*:ULTRIX:*:*)
 	echo mips-dec-ultrix${UNAME_RELEASE}
@@ -118,12 +411,47 @@
     VAX*:ULTRIX*:*:*)
 	echo vax-dec-ultrix${UNAME_RELEASE}
 	exit 0 ;;
-    mips:*:4*:UMIPS)
-	echo mips-mips-riscos4sysv
+    2020:CLIX:*:* | 2430:CLIX:*:*)
+	echo clipper-intergraph-clix${UNAME_RELEASE}
 	exit 0 ;;
-    mips:*:5*:RISCos)
+    mips:*:*:UMIPS | mips:*:*:RISCos)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+#ifdef __cplusplus
+#include <stdio.h>  /* for printf() prototype */
+	int main (int argc, char *argv[]) {
+#else
+	int main (argc, argv) int argc; char *argv[]; {
+#endif
+	#if defined (host_mips) && defined (MIPSEB)
+	#if defined (SYSTYPE_SYSV)
+	  printf ("mips-mips-riscos%ssysv\n", argv[1]); exit (0);
+	#endif
+	#if defined (SYSTYPE_SVR4)
+	  printf ("mips-mips-riscos%ssvr4\n", argv[1]); exit (0);
+	#endif
+	#if defined (SYSTYPE_BSD43) || defined(SYSTYPE_BSD)
+	  printf ("mips-mips-riscos%sbsd\n", argv[1]); exit (0);
+	#endif
+	#endif
+	  exit (-1);
+	}
+EOF
+	$CC_FOR_BUILD -o $dummy $dummy.c \
+	  && $dummy `echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` \
+	  && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
+	rm -f $dummy.c $dummy && rmdir $tmpdir
 	echo mips-mips-riscos${UNAME_RELEASE}
 	exit 0 ;;
+    Motorola:PowerMAX_OS:*:*)
+	echo powerpc-motorola-powermax
+	exit 0 ;;
+    Motorola:*:4.3:PL8-*)
+	echo powerpc-harris-powermax
+	exit 0 ;;
+    Night_Hawk:*:*:PowerMAX_OS)
+	echo powerpc-harris-powermax
+	exit 0 ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
 	exit 0 ;;
@@ -138,16 +466,19 @@
 	exit 0 ;;
     AViiON:dgux:*:*)
         # DG/UX returns AViiON for all architectures
-        UNAME_PROCESSOR=`uname -p`
-        if [ $UNAME_PROCESSOR = mc88100 -o $UNAME_PROCESSOR = mc88100 ] ; then
-	if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx \
-	     -o ${TARGET_BINARY_INTERFACE}x = x ] ; then
+        UNAME_PROCESSOR=`/usr/bin/uname -p`
+	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
+	then
+	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
+	       [ ${TARGET_BINARY_INTERFACE}x = x ]
+	    then
 		echo m88k-dg-dgux${UNAME_RELEASE}
-	else
+	    else
 		echo m88k-dg-dguxbcs${UNAME_RELEASE}
+	    fi
+	else
+	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
-        else echo i586-dg-dgux${UNAME_RELEASE}
-        fi
  	exit 0 ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
@@ -165,15 +496,24 @@
     *:IRIX*:*:*)
 	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
 	exit 0 ;;
-   ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
+    ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
 	echo romp-ibm-aix      # uname -m gives an 8 hex-code CPU id
 	exit 0 ;;              # Note that: echo "'`uname -s`'" gives 'AIX '
-    i[34]86:AIX:*:*)
+    i*86:AIX:*:*)
 	echo i386-ibm-aix
 	exit 0 ;;
+    ia64:AIX:*:*)
+	if [ -x /usr/bin/oslevel ] ; then
+		IBM_REV=`/usr/bin/oslevel`
+	else
+		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
+	fi
+	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
+	exit 0 ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h >/dev/null 2>&1; then
-		sed 's/^		//' << EOF >dummy.c
+		eval $set_cc_for_build
+		sed 's/^		//' << EOF >$dummy.c
 		#include <sys/systemcfg.h>
 
 		main()
@@ -184,8 +524,8 @@
 			exit(0);
 			}
 EOF
-		${CC-cc} dummy.c -o dummy && ./dummy && rm dummy.c dummy && exit 0
-		rm -f dummy.c dummy
+		$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
+		rm -f $dummy.c $dummy && rmdir $tmpdir
 		echo rs6000-ibm-aix3.2.5
 	elif grep bos324 /usr/include/stdio.h >/dev/null 2>&1; then
 		echo rs6000-ibm-aix3.2.4
@@ -193,8 +533,9 @@
 		echo rs6000-ibm-aix3.2
 	fi
 	exit 0 ;;
-    *:AIX:*:4)
-	if /usr/sbin/lsattr -EHl proc0 | grep POWER >/dev/null 2>&1; then
+    *:AIX:*:[45])
+	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
+	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
 		IBM_ARCH=rs6000
 	else
 		IBM_ARCH=powerpc
@@ -202,7 +543,7 @@
 	if [ -x /usr/bin/oslevel ] ; then
 		IBM_REV=`/usr/bin/oslevel`
 	else
-		IBM_REV=4.${UNAME_RELEASE}
+		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
 	exit 0 ;;
@@ -212,8 +553,8 @@
     ibmrt:4.4BSD:*|romp-ibm:BSD:*)
 	echo romp-ibm-bsd4.4
 	exit 0 ;;
-    ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC NetBSD and
-	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to 
+    ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
+	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
 	exit 0 ;;                           # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
@@ -227,18 +568,75 @@
     hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
 	echo m68k-hp-bsd4.4
 	exit 0 ;;
-    9000/[3478]??:HP-UX:*:*)
+    9000/[34678]??:HP-UX:*:*)
+	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	case "${UNAME_MACHINE}" in
 	    9000/31? )            HP_ARCH=m68000 ;;
 	    9000/[34]?? )         HP_ARCH=m68k ;;
-	    9000/7?? | 9000/8?[679] ) HP_ARCH=hppa1.1 ;;
-	    9000/8?? )            HP_ARCH=hppa1.0 ;;
+	    9000/[678][0-9][0-9])
+		if [ -x /usr/bin/getconf ]; then
+		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
+                    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+                    case "${sc_cpu_version}" in
+                      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
+                      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
+                      532)                      # CPU_PA_RISC2_0
+                        case "${sc_kernel_bits}" in
+                          32) HP_ARCH="hppa2.0n" ;;
+                          64) HP_ARCH="hppa2.0w" ;;
+			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
+                        esac ;;
+                    esac
+		fi
+		if [ "${HP_ARCH}" = "" ]; then
+		    eval $set_cc_for_build
+		    sed 's/^              //' << EOF >$dummy.c
+
+              #define _HPUX_SOURCE
+              #include <stdlib.h>
+              #include <unistd.h>
+
+              int main ()
+              {
+              #if defined(_SC_KERNEL_BITS)
+                  long bits = sysconf(_SC_KERNEL_BITS);
+              #endif
+                  long cpu  = sysconf (_SC_CPU_VERSION);
+
+                  switch (cpu)
+              	{
+              	case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+              	case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+              	case CPU_PA_RISC2_0:
+              #if defined(_SC_KERNEL_BITS)
+              	    switch (bits)
+              		{
+              		case 64: puts ("hppa2.0w"); break;
+              		case 32: puts ("hppa2.0n"); break;
+              		default: puts ("hppa2.0"); break;
+              		} break;
+              #else  /* !defined(_SC_KERNEL_BITS) */
+              	    puts ("hppa2.0"); break;
+              #endif
+              	default: puts ("hppa1.0"); break;
+              	}
+                  exit (0);
+              }
+EOF
+		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
+		    if test -z "$HP_ARCH"; then HP_ARCH=hppa; fi
+		    rm -f $dummy.c $dummy && rmdir $tmpdir
+		fi ;;
 	esac
-	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
 	exit 0 ;;
+    ia64:HP-UX:*:*)
+	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
+	echo ia64-hp-hpux${HPUX_REV}
+	exit 0 ;;
     3050*:HI-UX:*:*)
-	sed 's/^	//' << EOF >dummy.c
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
 	#include <unistd.h>
 	int
 	main ()
@@ -263,8 +661,8 @@
 	  exit (0);
 	}
 EOF
-	${CC-cc} dummy.c -o dummy && ./dummy && rm dummy.c dummy && exit 0
-	rm -f dummy.c dummy
+	$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
+	rm -f $dummy.c $dummy && rmdir $tmpdir
 	echo unknown-hitachi-hiuxwe2
 	exit 0 ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
@@ -273,12 +671,22 @@
     9000/8??:4.3bsd:*:*)
 	echo hppa1.0-hp-bsd
 	exit 0 ;;
+    *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
+	echo hppa1.0-hp-mpeix
+	exit 0 ;;
     hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
 	echo hppa1.1-hp-osf
 	exit 0 ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
 	exit 0 ;;
+    i*86:OSF1:*:*)
+	if [ -x /usr/sbin/sysversion ] ; then
+	    echo ${UNAME_MACHINE}-unknown-osf1mk
+	else
+	    echo ${UNAME_MACHINE}-unknown-osf1
+	fi
+	exit 0 ;;
     parisc*:Lites*:*:*)
 	echo hppa1.1-hp-lites
 	exit 0 ;;
@@ -300,105 +708,275 @@
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
         exit 0 ;;
-    CRAY*X-MP:*:*:*)
-	echo xmp-cray-unicos
-        exit 0 ;;
     CRAY*Y-MP:*:*:*)
-	echo ymp-cray-unicos${UNAME_RELEASE}
-	exit 0 ;;
-    CRAY*C90:*:*:*)
-	echo c90-cray-unicos${UNAME_RELEASE}
+	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
-    CRAY-2:*:*:*)
-	echo cray2-cray-unicos
+    CRAY*[A-Z]90:*:*:*)
+	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
+	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
+	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
+	      -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
+    CRAY*TS:*:*:*)
+	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
+    CRAY*T3D:*:*:*)
+	echo alpha-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
+    CRAY*T3E:*:*:*)
+	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
+    CRAY*SV1:*:*:*)
+	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
+    F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
+	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+        FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
+        echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
         exit 0 ;;
-    hp3[0-9][05]:NetBSD:*:*)
-	echo m68k-hp-netbsd${UNAME_RELEASE}
+    i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
+	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
 	exit 0 ;;
-    i[34]86:BSD/386:*:* | *:BSD/OS:*:*)
+    sparc*:BSD/OS:*:*)
+	echo sparc-unknown-bsdi${UNAME_RELEASE}
+	exit 0 ;;
+    *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit 0 ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
-	exit 0 ;;
-    *:NetBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-netbsd`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+	# Determine whether the default compiler uses glibc.
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#include <features.h>
+	#if __GLIBC__ >= 2
+	LIBC=gnu
+	#else
+	LIBC=
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
+	rm -f $dummy.c && rmdir $tmpdir
+	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
 	exit 0 ;;
     i*:CYGWIN*:*)
-	echo i386-unknown-cygwin32
+	echo ${UNAME_MACHINE}-pc-cygwin
+	exit 0 ;;
+    i*:MINGW*:*)
+	echo ${UNAME_MACHINE}-pc-mingw32
+	exit 0 ;;
+    i*:PW*:*)
+	echo ${UNAME_MACHINE}-pc-pw32
+	exit 0 ;;
+    x86:Interix*:3*)
+	echo i386-pc-interix3
+	exit 0 ;;
+    i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
+	# How do we know it's Interix rather than the generic POSIX subsystem?
+	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
+	# UNAME_MACHINE based on the output of uname instead of i386?
+	echo i386-pc-interix
+	exit 0 ;;
+    i*:UWIN*:*)
+	echo ${UNAME_MACHINE}-pc-uwin
 	exit 0 ;;
     p*:CYGWIN*:*)
-	echo powerpcle-unknown-cygwin32
+	echo powerpcle-unknown-cygwin
+	exit 0 ;;
+    prep*:SunOS:5.*:*)
+	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
     *:GNU:*:*)
-	echo `echo ${UNAME_MACHINE}|sed -e 's,/.*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
+	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
+	exit 0 ;;
+    i*86:Minix:*:*)
+	echo ${UNAME_MACHINE}-pc-minix
+	exit 0 ;;
+    arm*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
+    ia64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
+    m68*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
+    mips:Linux:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#undef CPU
+	#undef mips
+	#undef mipsel
+	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
+	CPU=mipsel
+	#else
+	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
+	CPU=mips
+	#else
+	CPU=
+	#endif
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^CPU=`
+	rm -f $dummy.c && rmdir $tmpdir
+	test x"${CPU}" != x && echo "${CPU}-pc-linux-gnu" && exit 0
+	;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit 0 ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit 0 ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep ld.so.1 >/dev/null
+	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit 0 ;;
+    parisc:Linux:*:* | hppa:Linux:*:*)
+	# Look for CPU level
+	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
+	  PA7*) echo hppa1.1-unknown-linux-gnu ;;
+	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
+	  *)    echo hppa-unknown-linux-gnu ;;
+	esac
+	exit 0 ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
 	exit 0 ;;
-    *:Linux:*:*)
+    s390:Linux:*:* | s390x:Linux:*:*)
+	echo ${UNAME_MACHINE}-ibm-linux
+	exit 0 ;;
+    sh*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
+    sparc:Linux:*:* | sparc64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
+    x86_64:Linux:*:*)
+	echo x86_64-unknown-linux-gnu
+	exit 0 ;;
+    i*86:Linux:*:*)
 	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us.
-	ld_help_string=`ld --help 2>&1`
-	if echo "$ld_help_string" | grep >/dev/null 2>&1 "supported emulations: elf_i[345]86"; then
-	  echo "${UNAME_MACHINE}-unknown-linux" ; exit 0
-	elif echo "$ld_help_string" | grep >/dev/null 2>&1 "supported emulations: i[345]86linux"; then
-	  echo "${UNAME_MACHINE}-unknown-linuxaout" ; exit 0
-	elif echo "$ld_help_string" | grep >/dev/null 2>&1 "supported emulations: i[345]86coff"; then
-	  echo "${UNAME_MACHINE}-unknown-linuxcoff" ; exit 0
-	elif echo "$ld_help_string" | grep >/dev/null 2>&1 "supported emulations: m68kelf"; then
-	  echo "${UNAME_MACHINE}-unknown-linux" ; exit 0
-	elif echo "$ld_help_string" | grep >/dev/null 2>&1 "supported emulations: m68klinux"; then
-	  echo "${UNAME_MACHINE}-unknown-linuxaout" ; exit 0
-	elif test "${UNAME_MACHINE}" = "alpha" ; then
-	  echo alpha-unknown-linux ; exit 0
-	else
-	  # Either a pre-BFD a.out linker (linuxoldld) or one that does not give us
-	  # useful --help.  Gcc wants to distinguish between linuxoldld and linuxaout.
-	  test ! -d /usr/lib/ldscripts/. \
-	    && echo "${UNAME_MACHINE}-unknown-linuxoldld" && exit 0
-	  # Determine whether the default compiler is a.out or elf
-	  cat >dummy.c <<EOF
-main(argc, argv)
-int argc;
-char *argv[];
-{
-#ifdef __ELF__
-  printf ("%s-unknown-linux\n", argv[1]);
-#else
-  printf ("%s-unknown-linuxaout\n", argv[1]);
-#endif
-  return 0;
-}
+	# first see if it will tell us. cd to the root directory to prevent
+	# problems with other programs or directories called `ld' in the path.
+	# Set LC_ALL=C to ensure ld outputs messages in English.
+	ld_supported_targets=`cd /; LC_ALL=C ld --help 2>&1 \
+			 | sed -ne '/supported targets:/!d
+				    s/[ 	][ 	]*/ /g
+				    s/.*supported targets: *//
+				    s/ .*//
+				    p'`
+        case "$ld_supported_targets" in
+	  elf32-i386)
+		TENTATIVE="${UNAME_MACHINE}-pc-linux-gnu"
+		;;
+	  a.out-i386-linux)
+		echo "${UNAME_MACHINE}-pc-linux-gnuaout"
+		exit 0 ;;
+	  coff-i386)
+		echo "${UNAME_MACHINE}-pc-linux-gnucoff"
+		exit 0 ;;
+	  "")
+		# Either a pre-BFD a.out linker (linux-gnuoldld) or
+		# one that does not give us useful --help.
+		echo "${UNAME_MACHINE}-pc-linux-gnuoldld"
+		exit 0 ;;
+	esac
+	# Determine whether the default compiler is a.out or elf
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#include <features.h>
+	#ifdef __ELF__
+	# ifdef __GLIBC__
+	#  if __GLIBC__ >= 2
+	LIBC=gnu
+	#  else
+	LIBC=gnulibc1
+	#  endif
+	# else
+	LIBC=gnulibc1
+	# endif
+	#else
+	#ifdef __INTEL_COMPILER
+	LIBC=gnu
+	#else
+	LIBC=gnuaout
+	#endif
+	#endif
 EOF
-	  ${CC-cc} dummy.c -o dummy 2>/dev/null && ./dummy "${UNAME_MACHINE}" && rm dummy.c dummy && exit 0
-	  rm -f dummy.c dummy
-	fi ;;
-# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.  earlier versions
-# are messed up and put the nodename in both sysname and nodename.
-    i[34]86:DYNIX/ptx:4*:*)
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
+	rm -f $dummy.c && rmdir $tmpdir
+	test x"${LIBC}" != x && echo "${UNAME_MACHINE}-pc-linux-${LIBC}" && exit 0
+	test x"${TENTATIVE}" != x && echo "${TENTATIVE}" && exit 0
+	;;
+    i*86:DYNIX/ptx:4*:*)
+	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
+	# earlier versions are messed up and put the nodename in both
+	# sysname and nodename.
 	echo i386-sequent-sysv4
 	exit 0 ;;
-    i[34]86:*:4.*:* | i[34]86:SYSTEM_V:4.*:*)
+    i*86:UNIX_SV:4.2MP:2.*)
+        # Unixware is an offshoot of SVR4, but it has its own version
+        # number series starting with 2...
+        # I am not positive that other SVR4 systems won't match this,
+	# I just have to hope.  -- rms.
+        # Use sysv4.2uw... so that sysv4* matches it.
+	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
+	exit 0 ;;
+    i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
+	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then
-		echo ${UNAME_MACHINE}-univel-sysv${UNAME_RELEASE}
+		echo ${UNAME_MACHINE}-univel-sysv${UNAME_REL}
 	else
-		echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}
+		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
 	fi
 	exit 0 ;;
-    i[34]86:*:3.2:*)
+    i*86:*:5:[78]*)
+	case `/bin/uname -X | grep "^Machine"` in
+	    *486*)	     UNAME_MACHINE=i486 ;;
+	    *Pentium)	     UNAME_MACHINE=i586 ;;
+	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
+	esac
+	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
+	exit 0 ;;
+    i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' </usr/options/cb.name`
-		echo ${UNAME_MACHINE}-unknown-isc$UNAME_REL
+		echo ${UNAME_MACHINE}-pc-isc$UNAME_REL
 	elif /bin/uname -X 2>/dev/null >/dev/null ; then
-		UNAME_REL=`(/bin/uname -X|egrep Release|sed -e 's/.*= //')`
-		(/bin/uname -X|egrep i80486 >/dev/null) && UNAME_MACHINE=i486
-		(/bin/uname -X|egrep '^Machine.*Pentium' >/dev/null) \
+		UNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`
+		(/bin/uname -X|grep i80486 >/dev/null) && UNAME_MACHINE=i486
+		(/bin/uname -X|grep '^Machine.*Pentium' >/dev/null) \
 			&& UNAME_MACHINE=i586
-		echo ${UNAME_MACHINE}-unknown-sco$UNAME_REL
+		(/bin/uname -X|grep '^Machine.*Pent *II' >/dev/null) \
+			&& UNAME_MACHINE=i686
+		(/bin/uname -X|grep '^Machine.*Pentium Pro' >/dev/null) \
+			&& UNAME_MACHINE=i686
+		echo ${UNAME_MACHINE}-pc-sco$UNAME_REL
 	else
-		echo ${UNAME_MACHINE}-unknown-sysv32
+		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
 	exit 0 ;;
+    i*86:*DOS:*:*)
+	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	exit 0 ;;
+    pc:*:*:*)
+	# Left here for compatibility:
+        # uname -m prints for DJGPP always 'pc', but it prints nothing about
+        # the processor, so we play safe by assuming i386.
+	echo i386-pc-msdosdjgpp
+        exit 0 ;;
     Intel:Mach:3*:*)
-	echo i386-unknown-mach3
+	echo i386-pc-mach3
 	exit 0 ;;
     paragon:*:*:*)
 	echo i860-intel-osf1
@@ -414,28 +992,45 @@
 	# "miniframe"
 	echo m68010-convergent-sysv
 	exit 0 ;;
-    M680[234]0:*:R3V[567]*:*)
+    mc68k:UNIX:SYSTEM5:3.51m)
+	echo m68k-convergent-sysv
+	exit 0 ;;
+    M68*:*:R3V[567]*:*)
 	test -r /sysV68 && echo 'm68k-motorola-sysv' && exit 0 ;;
-    3[34]??:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0)
-        uname -p 2>/dev/null | grep 86 >/dev/null \
-          && echo i486-ncr-sysv4.3 && exit 0 ;;
+    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0)
+	OS_REL=''
+	test -r /etc/.relid \
+	&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && echo i486-ncr-sysv4.3${OS_REL} && exit 0
+	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
+	  && echo i586-ncr-sysv4.3${OS_REL} && exit 0 ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
-        uname -p 2>/dev/null | grep 86 >/dev/null \
+        /bin/uname -p 2>/dev/null | grep 86 >/dev/null \
           && echo i486-ncr-sysv4 && exit 0 ;;
-    m680[234]0:LynxOS:2.[23]*:*)
-	echo m68k-lynx-lynxos${UNAME_RELEASE}
+    m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
+	echo m68k-unknown-lynxos${UNAME_RELEASE}
 	exit 0 ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
 	exit 0 ;;
-    i[34]86:LynxOS:2.[23]*:*)
-	echo i386-lynx-lynxos${UNAME_RELEASE}
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	echo i386-unknown-lynxos${UNAME_RELEASE}
+	exit 0 ;;
+    TSUNAMI:LynxOS:2.*:*)
+	echo sparc-unknown-lynxos${UNAME_RELEASE}
 	exit 0 ;;
-    TSUNAMI:LynxOS:2.[23]*:*)
-	echo sparc-lynx-lynxos${UNAME_RELEASE}
+    rs6000:LynxOS:2.*:*)
+	echo rs6000-unknown-lynxos${UNAME_RELEASE}
 	exit 0 ;;
-    rs6000:LynxOS:2.[23]*:*)
-	echo rs6000-lynx-lynxos${UNAME_RELEASE}
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+	echo powerpc-unknown-lynxos${UNAME_RELEASE}
+	exit 0 ;;
+    SM[BE]S:UNIX_SV:*:*)
+	echo mips-dde-sysv${UNAME_RELEASE}
+	exit 0 ;;
+    RM*:ReliantUNIX-*:*:*)
+	echo mips-sni-sysv4
 	exit 0 ;;
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
@@ -448,22 +1043,133 @@
 		echo ns32k-sni-sysv
 	fi
 	exit 0 ;;
+    PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+                      # says <Richard.M.Bartel@ccMail.Census.GOV>
+        echo i586-unisys-sysv4
+        exit 0 ;;
+    *:UNIX_System_V:4*:FTX*)
+	# From Gerald Hewes <hewes@openmarket.com>.
+	# How about differentiating between stratus architectures? -djm
+	echo hppa1.1-stratus-sysv4
+	exit 0 ;;
+    *:*:*:FTX*)
+	# From seanf@swdc.stratus.com.
+	echo i860-stratus-sysv4
+	exit 0 ;;
+    *:VOS:*:*)
+	# From Paul.Green@stratus.com.
+	echo hppa1.1-stratus-vos
+	exit 0 ;;
     mc68*:A/UX:*:*)
 	echo m68k-apple-aux${UNAME_RELEASE}
 	exit 0 ;;
-    R3000:*System_V*:*:*)
+    news*:NEWS-OS:6*:*)
+	echo mips-sony-newsos6
+	exit 0 ;;
+    R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
 	        echo mips-nec-sysv${UNAME_RELEASE}
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
         exit 0 ;;
+    BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
+	echo powerpc-be-beos
+	exit 0 ;;
+    BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
+	echo powerpc-apple-beos
+	exit 0 ;;
+    BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
+	echo i586-pc-beos
+	exit 0 ;;
+    SX-4:SUPER-UX:*:*)
+	echo sx4-nec-superux${UNAME_RELEASE}
+	exit 0 ;;
+    SX-5:SUPER-UX:*:*)
+	echo sx5-nec-superux${UNAME_RELEASE}
+	exit 0 ;;
+    SX-6:SUPER-UX:*:*)
+	echo sx6-nec-superux${UNAME_RELEASE}
+	exit 0 ;;
+    Power*:Rhapsody:*:*)
+	echo powerpc-apple-rhapsody${UNAME_RELEASE}
+	exit 0 ;;
+    *:Rhapsody:*:*)
+	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
+	exit 0 ;;
+    *:Darwin:*:*)
+	echo `uname -p`-apple-darwin${UNAME_RELEASE}
+	exit 0 ;;
+    *:procnto*:*:* | *:QNX:[0123456789]*:*)
+	UNAME_PROCESSOR=`uname -p`
+	if test "$UNAME_PROCESSOR" = "x86"; then
+		UNAME_PROCESSOR=i386
+		UNAME_MACHINE=pc
+	fi
+	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
+	exit 0 ;;
+    *:QNX:*:4*)
+	echo i386-pc-qnx
+	exit 0 ;;
+    NSR-[DGKLNPTVW]:NONSTOP_KERNEL:*:*)
+	echo nsr-tandem-nsk${UNAME_RELEASE}
+	exit 0 ;;
+    *:NonStop-UX:*:*)
+	echo mips-compaq-nonstopux
+	exit 0 ;;
+    BS2000:POSIX*:*:*)
+	echo bs2000-siemens-sysv
+	exit 0 ;;
+    DS/*:UNIX_System_V:*:*)
+	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
+	exit 0 ;;
+    *:Plan9:*:*)
+	# "uname -m" is not consistent, so use $cputype instead. 386
+	# is converted to i386 for consistency with other x86
+	# operating systems.
+	if test "$cputype" = "386"; then
+	    UNAME_MACHINE=i386
+	else
+	    UNAME_MACHINE="$cputype"
+	fi
+	echo ${UNAME_MACHINE}-unknown-plan9
+	exit 0 ;;
+    i*86:OS/2:*:*)
+	# If we were able to find `uname', then EMX Unix compatibility
+	# is probably installed.
+	echo ${UNAME_MACHINE}-pc-os2-emx
+	exit 0 ;;
+    *:TOPS-10:*:*)
+	echo pdp10-unknown-tops10
+	exit 0 ;;
+    *:TENEX:*:*)
+	echo pdp10-unknown-tenex
+	exit 0 ;;
+    KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
+	echo pdp10-dec-tops20
+	exit 0 ;;
+    XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
+	echo pdp10-xkl-tops20
+	exit 0 ;;
+    *:TOPS-20:*:*)
+	echo pdp10-unknown-tops20
+	exit 0 ;;
+    *:ITS:*:*)
+	echo pdp10-unknown-its
+	exit 0 ;;
+    i*86:XTS-300:*:STOP)
+	echo ${UNAME_MACHINE}-unknown-stop
+	exit 0 ;;
+    i*86:atheos:*:*)
+	echo ${UNAME_MACHINE}-unknown-atheos
+	exit 0 ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1>&2
 #echo "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" 1>&2
 
-cat >dummy.c <<EOF
+eval $set_cc_for_build
+cat >$dummy.c <<EOF
 #ifdef _SEQUENT_
 # include <sys/types.h>
 # include <sys/utsname.h>
@@ -501,7 +1207,10 @@
 #endif
   int version;
   version=`(hostinfo | sed -n 's/.*NeXT Mach \([0-9]*\).*/\1/p') 2>/dev/null`;
-  printf ("%s-next-nextstep%s\n", __ARCHITECTURE__,  version==2 ? "2" : "3");
+  if (version < 4)
+    printf ("%s-next-nextstep%d\n", __ARCHITECTURE__, version);
+  else
+    printf ("%s-next-openstep%d\n", __ARCHITECTURE__, version);
   exit (0);
 #endif
 
@@ -518,7 +1227,7 @@
 #endif
 
 #if defined (__386BSD__)
-  printf ("i386-unknown-bsd\n"); exit (0);
+  printf ("i386-pc-bsd\n"); exit (0);
 #endif
 
 #if defined (sequent)
@@ -546,11 +1255,24 @@
 #endif
 
 #if defined (vax)
-#if !defined (ultrix)
-  printf ("vax-dec-bsd\n"); exit (0);
-#else
-  printf ("vax-dec-ultrix\n"); exit (0);
-#endif
+# if !defined (ultrix)
+#  include <sys/param.h>
+#  if defined (BSD)
+#   if BSD == 43
+      printf ("vax-dec-bsd4.3\n"); exit (0);
+#   else
+#    if BSD == 199006
+      printf ("vax-dec-bsd4.3reno\n"); exit (0);
+#    else
+      printf ("vax-dec-bsd\n"); exit (0);
+#    endif
+#   endif
+#  else
+    printf ("vax-dec-bsd\n"); exit (0);
+#  endif
+# else
+    printf ("vax-dec-ultrix\n"); exit (0);
+# endif
 #endif
 
 #if defined (alliant) && defined (i860)
@@ -561,8 +1283,8 @@
 }
 EOF
 
-${CC-cc} dummy.c -o dummy 2>/dev/null && ./dummy && rm dummy.c dummy && exit 0
-rm -f dummy.c dummy
+$CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
+rm -f $dummy.c $dummy && rmdir $tmpdir
 
 # Apollos put the system type in the environment.
 
@@ -594,6 +1316,48 @@
     esac
 fi
 
-#echo '(Unable to guess system type)' 1>&2
+cat >&2 <<EOF
+$0: unable to guess system type
+
+This script, last modified $timestamp, has failed to recognize
+the operating system you are using. It is advised that you
+download the most up to date version of the config scripts from
+
+    ftp://ftp.gnu.org/pub/gnu/config/
+
+If the version you run ($0) is already up to date, please
+send the following data and any information you think might be
+pertinent to <config-patches@gnu.org> in order to provide the needed
+information to handle your system.
+
+config.guess timestamp = $timestamp
+
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null`
+
+hostinfo               = `(hostinfo) 2>/dev/null`
+/bin/universe          = `(/bin/universe) 2>/dev/null`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null`
+/bin/arch              = `(/bin/arch) 2>/dev/null`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null`
+
+UNAME_MACHINE = ${UNAME_MACHINE}
+UNAME_RELEASE = ${UNAME_RELEASE}
+UNAME_SYSTEM  = ${UNAME_SYSTEM}
+UNAME_VERSION = ${UNAME_VERSION}
+EOF
 
 exit 1
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "timestamp='"
+# time-stamp-format: "%:y-%02m-%02d"
+# time-stamp-end: "'"
+# End:
--- a/config.sub
+++ b/config.sub
@@ -1,9 +1,13 @@
 #! /bin/sh
-# Configuration validation subroutine script, version 1.1.
-#   Copyright (C) 1991, 1992, 1993, 1994, 1995 Free Software Foundation, Inc.
+# Configuration validation subroutine script.
+#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
+#   2000, 2001, 2002 Free Software Foundation, Inc.
+
+timestamp='2002-09-05'
+
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
-# can handle that machine.  It does not imply ALL GNU software can. 
+# can handle that machine.  It does not imply ALL GNU software can.
 #
 # This file is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -25,6 +29,9 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+# Please send patches to <config-patches@gnu.org>.  Submit a context
+# diff and a properly formatted ChangeLog entry.
+#
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
@@ -41,32 +48,87 @@
 # The goal of this file is to map all the various variations of a given
 # machine specification into a single specification in the form:
 #	CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM
+# or in some cases, the newer four-part form:
+#	CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM
 # It is wrong to echo any other type of specification.
 
-if [ x$1 = x ]
-then
-	echo Configuration name missing. 1>&2
-	echo "Usage: $0 CPU-MFR-OPSYS" 1>&2
-	echo "or     $0 ALIAS" 1>&2
-	echo where ALIAS is a recognized configuration type. 1>&2
-	exit 1
-fi
+me=`echo "$0" | sed -e 's,.*/,,'`
 
-# First pass through any local machine types.
-case $1 in
-	*local*)
-		echo $1
-		exit 0
-		;;
-	*)
-	;;
+usage="\
+Usage: $0 [OPTION] CPU-MFR-OPSYS
+       $0 [OPTION] ALIAS
+
+Canonicalize a configuration name.
+
+Operation modes:
+  -h, --help         print this help, then exit
+  -t, --time-stamp   print date of last modification, then exit
+  -v, --version      print version number, then exit
+
+Report bugs and patches to <config-patches@gnu.org>."
+
+version="\
+GNU config.sub ($timestamp)
+
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+Free Software Foundation, Inc.
+
+This is free software; see the source for copying conditions.  There is NO
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
+
+help="
+Try \`$me --help' for more information."
+
+# Parse command line
+while test $# -gt 0 ; do
+  case $1 in
+    --time-stamp | --time* | -t )
+       echo "$timestamp" ; exit 0 ;;
+    --version | -v )
+       echo "$version" ; exit 0 ;;
+    --help | --h* | -h )
+       echo "$usage"; exit 0 ;;
+    -- )     # Stop option processing
+       shift; break ;;
+    - )	# Use stdin as input.
+       break ;;
+    -* )
+       echo "$me: invalid option $1$help"
+       exit 1 ;;
+
+    *local*)
+       # First pass through any local machine types.
+       echo $1
+       exit 0;;
+
+    * )
+       break ;;
+  esac
+done
+
+case $# in
+ 0) echo "$me: missing argument$help" >&2
+    exit 1;;
+ 1) ;;
+ *) echo "$me: too many arguments$help" >&2
+    exit 1;;
 esac
 
-# Separate what the user gave into CPU-COMPANY and OS (if any).
-basic_machine=`echo $1 | sed 's/-[^-]*$//'`
-if [ $basic_machine != $1 ]
-then os=`echo $1 | sed 's/.*-/-/'`
-else os=; fi
+# Separate what the user gave into CPU-COMPANY and OS or KERNEL-OS (if any).
+# Here we must recognize all the valid KERNEL-OS combinations.
+maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
+case $maybe_os in
+  nto-qnx* | linux-gnu* | freebsd*-gnu* | storm-chaos* | os2-emx* | windows32-* | rtmk-nova*)
+    os=-$maybe_os
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
+    ;;
+  *)
+    basic_machine=`echo $1 | sed 's/-[^-]*$//'`
+    if [ $basic_machine != $1 ]
+    then os=`echo $1 | sed 's/.*-/-/'`
+    else os=; fi
+    ;;
+esac
 
 ### Let's recognize common machines as not being operating systems so
 ### that things like config.sub decstation-3100 work.  We also
@@ -81,38 +143,64 @@
 	-unicom* | -ibm* | -next | -hp | -isi* | -apollo | -altos* | \
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
-	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp )
+	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
+	-apple | -axis)
 		os=
 		basic_machine=$1
 		;;
+	-sim | -cisco | -oki | -wec | -winbond)
+		os=
+		basic_machine=$1
+		;;
+	-scout)
+		;;
+	-wrs)
+		os=-vxworks
+		basic_machine=$1
+		;;
+	-chorusos*)
+		os=-chorusos
+		basic_machine=$1
+		;;
+ 	-chorusrdb)
+ 		os=-chorusrdb
+		basic_machine=$1
+ 		;;
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco5)
+		os=-sco3.2v5
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco4)
 		os=-sco3.2v4
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-sco3.2.[4-9]*)
 		os=`echo $os | sed -e 's/sco3.2./sco3.2v/'`
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-sco3.2v[4-9]*)
 		# Don't forget version if it is 3.2v4 or newer.
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-sco*)
 		os=-sco3.2v2
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-udk*)
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-isc)
 		os=-isc2.2
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-clix*)
 		basic_machine=clipper-intergraph
 		;;
 	-isc*)
-		basic_machine=`echo $1 | sed -e 's/86-.*/86-unknown/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
 	-lynx*)
 		os=-lynxos
@@ -123,44 +211,152 @@
 	-windowsnt*)
 		os=`echo $os | sed -e 's/windowsnt/winnt/'`
 		;;
+	-psos*)
+		os=-psos
+		;;
+	-mint | -mint[0-9]*)
+		basic_machine=m68k-atari
+		os=-mint
+		;;
 esac
 
 # Decode aliases for certain CPU-COMPANY combinations.
 case $basic_machine in
 	# Recognize the basic CPU types without company name.
 	# Some are omitted here because they have special meanings below.
-	tahoe | i[345]86 | i860 | m68k | m68000 | m88k | ns32k | arm \
-		| arme[lb] | pyramid \
-		| tron | a29k | 580 | i960 | h8300 | hppa1.0 | hppa1.1 \
-		| alpha | we32k | ns16k | clipper | sparclite | i370 | sh \
-		| powerpc | powerpcle | sparc64 | 1750a | dsp16xx | mips64 | mipsel \
-		| pdp11 | mips64el | mips64orion | mips64orionel \
-		| sparc)
+	1750a | 580 \
+	| a29k \
+	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
+	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| clipper \
+	| d10v | d30v | dlx | dsp16xx \
+	| fr30 | frv \
+	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
+	| i370 | i860 | i960 | ia64 \
+	| ip2k \
+	| m32r | m68000 | m68k | m88k | mcore \
+	| mips | mipsbe | mipseb | mipsel | mipsle \
+	| mips16 \
+	| mips64 | mips64el \
+	| mips64vr | mips64vrel \
+	| mips64orion | mips64orionel \
+	| mips64vr4100 | mips64vr4100el \
+	| mips64vr4300 | mips64vr4300el \
+	| mips64vr5000 | mips64vr5000el \
+	| mipsisa32 | mipsisa32el \
+	| mipsisa64 | mipsisa64el \
+	| mipsisa64sb1 | mipsisa64sb1el \
+	| mipsisa64sr71k | mipsisa64sr71kel \
+	| mipstx39 | mipstx39el \
+	| mn10200 | mn10300 \
+	| ns16k | ns32k \
+	| openrisc | or32 \
+	| pdp10 | pdp11 | pj | pjl \
+	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
+	| pyramid \
+	| sh | sh[1234] | sh3e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| sh64 | sh64le \
+	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv9 | sparcv9b \
+	| strongarm \
+	| tahoe | thumb | tic80 | tron \
+	| v850 | v850e \
+	| we32k \
+	| x86 | xscale | xstormy16 | xtensa \
+	| z8k)
+		basic_machine=$basic_machine-unknown
+		;;
+	m6811 | m68hc11 | m6812 | m68hc12)
+		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+
+	# We use `pc' rather than `unknown'
+	# because (1) that's what they normally are, and
+	# (2) the word "unknown" tends to confuse beginning users.
+	i*86 | x86_64)
+	  basic_machine=$basic_machine-pc
+	  ;;
 	# Object if more than one company name word.
 	*-*-*)
 		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
 		exit 1
 		;;
 	# Recognize the basic CPU types with company name.
-	vax-* | tahoe-* | i[345]86-* | i860-* | m68k-* | m68000-* | m88k-* \
-	      | sparc-* | ns32k-* | fx80-* | arm-* | c[123]* \
-	      | mips-* | pyramid-* | tron-* | a29k-* | romp-* | rs6000-* | power-* \
-	      | none-* | 580-* | cray2-* | h8300-* | i960-* | xmp-* | ymp-* \
-	      | hppa1.0-* | hppa1.1-* | alpha-* | we32k-* | cydra-* | ns16k-* \
-	      | pn-* | np1-* | xps100-* | clipper-* | orion-* | sparclite-* \
-	      | pdp11-* | sh-* | powerpc-* | powerpcle-* | sparc64-* | mips64-* | mipsel-* \
-	      | mips64el-* | mips64orion-* | mips64orionel-*)
+	580-* \
+	| a29k-* \
+	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
+	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
+	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
+	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
+	| avr-* \
+	| bs2000-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* \
+	| clipper-* | cydra-* \
+	| d10v-* | d30v-* | dlx-* \
+	| elxsi-* \
+	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| h8300-* | h8500-* \
+	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
+	| i*86-* | i860-* | i960-* | ia64-* \
+	| ip2k-* \
+	| m32r-* \
+	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
+	| m88110-* | m88k-* | mcore-* \
+	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
+	| mips16-* \
+	| mips64-* | mips64el-* \
+	| mips64vr-* | mips64vrel-* \
+	| mips64orion-* | mips64orionel-* \
+	| mips64vr4100-* | mips64vr4100el-* \
+	| mips64vr4300-* | mips64vr4300el-* \
+	| mips64vr5000-* | mips64vr5000el-* \
+	| mipsisa32-* | mipsisa32el-* \
+	| mipsisa64-* | mipsisa64el-* \
+	| mipsisa64sb1-* | mipsisa64sb1el-* \
+	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipstx39 | mipstx39el \
+	| none-* | np1-* | ns16k-* | ns32k-* \
+	| orion-* \
+	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
+	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
+	| pyramid-* \
+	| romp-* | rs6000-* \
+	| sh-* | sh[1234]-* | sh3e-* | sh[34]eb-* | shbe-* \
+	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
+	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
+	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| tahoe-* | thumb-* | tic30-* | tic4x-* | tic54x-* | tic80-* | tron-* \
+	| v850-* | v850e-* | vax-* \
+	| we32k-* \
+	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
+	| xtensa-* \
+	| ymp-* \
+	| z8k-*)
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
+	386bsd)
+		basic_machine=i386-unknown
+		os=-bsd
+		;;
 	3b1 | 7300 | 7300-att | att-7300 | pc7300 | safari | unixpc)
 		basic_machine=m68000-att
 		;;
 	3b*)
 		basic_machine=we32k-att
 		;;
+	a29khif)
+		basic_machine=a29k-amd
+		os=-udi
+		;;
+	adobe68k)
+		basic_machine=m68010-adobe
+		os=-scout
+		;;
 	alliant | fx80)
 		basic_machine=fx80-alliant
 		;;
@@ -171,29 +367,44 @@
 		basic_machine=a29k-none
 		os=-bsd
 		;;
+	amd64-*)
+		basic_machine=x86_64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	amdahl)
 		basic_machine=580-amdahl
 		os=-sysv
 		;;
 	amiga | amiga-*)
-		basic_machine=m68k-cbm
+		basic_machine=m68k-unknown
 		;;
-	amigados)
-		basic_machine=m68k-cbm
-		os=-amigados
+	amigaos | amigados)
+		basic_machine=m68k-unknown
+		os=-amigaos
 		;;
 	amigaunix | amix)
-		basic_machine=m68k-cbm
+		basic_machine=m68k-unknown
 		os=-sysv4
 		;;
 	apollo68)
 		basic_machine=m68k-apollo
 		os=-sysv
 		;;
+	apollo68bsd)
+		basic_machine=m68k-apollo
+		os=-bsd
+		;;
+	aux)
+		basic_machine=m68k-apple
+		os=-aux
+		;;
 	balance)
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	c90)
+		basic_machine=c90-cray
+		os=-unicos
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -214,23 +425,30 @@
 		basic_machine=c38-convex
 		os=-bsd
 		;;
-	cray | ymp)
-		basic_machine=ymp-cray
-		os=-unicos
-		;;
-	cray2)
-		basic_machine=cray2-cray
+	cray | j90)
+		basic_machine=j90-cray
 		os=-unicos
 		;;
 	crds | unos)
 		basic_machine=m68k-crds
 		;;
+	cris | cris-* | etrax*)
+		basic_machine=cris-axis
+		;;
 	da30 | da30-*)
 		basic_machine=m68k-da30
 		;;
 	decstation | decstation-3100 | pmax | pmax-* | pmin | dec3100 | decstatn)
 		basic_machine=mips-dec
 		;;
+	decsystem10* | dec10*)
+		basic_machine=pdp10-dec
+		os=-tops10
+		;;
+	decsystem20* | dec20*)
+		basic_machine=pdp10-dec
+		os=-tops20
+		;;
 	delta | 3300 | motorola-3300 | motorola-delta \
 	      | 3300-motorola | delta-motorola)
 		basic_machine=m68k-motorola
@@ -258,6 +476,10 @@
 	encore | umax | mmax)
 		basic_machine=ns32k-encore
 		;;
+	es1800 | OSE68k | ose68k | ose | OSE)
+		basic_machine=m68k-ericsson
+		os=-ose
+		;;
 	fx2800)
 		basic_machine=i860-alliant
 		;;
@@ -268,6 +490,10 @@
 		basic_machine=tron-gmicro
 		os=-sysv
 		;;
+	go32)
+		basic_machine=i386-pc
+		os=-go32
+		;;
 	h3050r* | hiux*)
 		basic_machine=hppa1.1-hitachi
 		os=-hiuxwe2
@@ -276,6 +502,14 @@
 		basic_machine=h8300-hitachi
 		os=-hms
 		;;
+	h8300xray)
+		basic_machine=h8300-hitachi
+		os=-xray
+		;;
+	h8500hms)
+		basic_machine=h8500-hitachi
+		os=-hms
+		;;
 	harris)
 		basic_machine=m88k-harris
 		os=-sysv3
@@ -291,39 +525,74 @@
 		basic_machine=m68k-hp
 		os=-hpux
 		;;
+	hp3k9[0-9][0-9] | hp9[0-9][0-9])
+		basic_machine=hppa1.0-hp
+		;;
 	hp9k2[0-9][0-9] | hp9k31[0-9])
 		basic_machine=m68000-hp
 		;;
 	hp9k3[2-9][0-9])
 		basic_machine=m68k-hp
 		;;
-	hp9k7[0-9][0-9] | hp7[0-9][0-9] | hp9k8[0-9]7 | hp8[0-9]7)
+	hp9k6[0-9][0-9] | hp6[0-9][0-9])
+		basic_machine=hppa1.0-hp
+		;;
+	hp9k7[0-79][0-9] | hp7[0-79][0-9])
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k78[0-9] | hp78[0-9])
+		# FIXME: really hppa2.0-hp
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k8[67]1 | hp8[67]1 | hp9k80[24] | hp80[24] | hp9k8[78]9 | hp8[78]9 | hp9k893 | hp893)
+		# FIXME: really hppa2.0-hp
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k8[0-9][13679] | hp8[0-9][13679])
 		basic_machine=hppa1.1-hp
 		;;
 	hp9k8[0-9][0-9] | hp8[0-9][0-9])
 		basic_machine=hppa1.0-hp
 		;;
+	hppa-next)
+		os=-nextstep3
+		;;
+	hppaosf)
+		basic_machine=hppa1.1-hp
+		os=-osf
+		;;
+	hppro)
+		basic_machine=hppa1.1-hp
+		os=-proelf
+		;;
 	i370-ibm* | ibm*)
 		basic_machine=i370-ibm
-		os=-mvs
 		;;
 # I'm not sure what "Sysv32" means.  Should this be sysv3.2?
-	i[345]86v32)
-		basic_machine=`echo $1 | sed -e 's/86.*/86-unknown/'`
+	i*86v32)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv32
 		;;
-	i[345]86v4*)
-		basic_machine=`echo $1 | sed -e 's/86.*/86-unknown/'`
+	i*86v4*)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv4
 		;;
-	i[345]86v)
-		basic_machine=`echo $1 | sed -e 's/86.*/86-unknown/'`
+	i*86v)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv
 		;;
-	i[345]86sol2)
-		basic_machine=`echo $1 | sed -e 's/86.*/86-unknown/'`
+	i*86sol2)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-solaris2
 		;;
+	i386mach)
+		basic_machine=i386-mach
+		os=-mach
+		;;
+	i386-vsta | vsta)
+		basic_machine=i386-unknown
+		os=-vsta
+		;;
 	iris | iris4d)
 		basic_machine=mips-sgi
 		case $os in
@@ -349,19 +618,55 @@
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+	mingw32)
+		basic_machine=i386-pc
+		os=-mingw32
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
+	*mint | -mint[0-9]* | *MiNT | *MiNT[0-9]*)
+		basic_machine=m68k-atari
+		os=-mint
+		;;
 	mips3*-*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`
 		;;
 	mips3*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
 		;;
+	mmix*)
+		basic_machine=mmix-knuth
+		os=-mmixware
+		;;
+	monitor)
+		basic_machine=m68k-rom68k
+		os=-coff
+		;;
+	morphos)
+		basic_machine=powerpc-unknown
+		os=-morphos
+		;;
+	msdos)
+		basic_machine=i386-pc
+		os=-msdos
+		;;
+	mvs)
+		basic_machine=i370-ibm
+		os=-mvs
+		;;
 	ncr3000)
 		basic_machine=i486-ncr
 		os=-sysv4
 		;;
+	netbsd386)
+		basic_machine=i386-unknown
+		os=-netbsd
+		;;
+	netwinder)
+		basic_machine=armv4l-rebel
+		os=-linux
+		;;
 	news | news700 | news800 | news900)
 		basic_machine=m68k-sony
 		os=-newsos
@@ -374,6 +679,10 @@
 		basic_machine=mips-sony
 		os=-newsos
 		;;
+	necv70)
+		basic_machine=v70-nec
+		os=-sysv
+		;;
 	next | m*-next )
 		basic_machine=m68k-next
 		case $os in
@@ -399,9 +708,36 @@
 		basic_machine=i960-intel
 		os=-nindy
 		;;
+	mon960)
+		basic_machine=i960-intel
+		os=-mon960
+		;;
+	nonstopux)
+		basic_machine=mips-compaq
+		os=-nonstopux
+		;;
 	np1)
 		basic_machine=np1-gould
 		;;
+	nsr-tandem)
+		basic_machine=nsr-tandem
+		;;
+	op50n-* | op60c-*)
+		basic_machine=hppa1.1-oki
+		os=-proelf
+		;;
+	or32 | or32-*)
+		basic_machine=or32-unknown
+		os=-coff
+		;;
+	OSE68000 | ose68000)
+		basic_machine=m68000-ericsson
+		os=-ose
+		;;
+	os68k)
+		basic_machine=m68k-none
+		os=-os68k
+		;;
 	pa-hitachi)
 		basic_machine=hppa1.1-hitachi
 		os=-hiuxwe2
@@ -416,49 +752,85 @@
 	pbb)
 		basic_machine=m68k-tti
 		;;
-        pc532 | pc532-*)
+	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
-	pentium | p5 | p6)
-		# We don't have specific support for the Intel Pentium (p6) followon yet, so just call it a Pentium
-		basic_machine=i586-intel
+	pentium | p5 | k5 | k6 | nexgen | viac3)
+		basic_machine=i586-pc
 		;;
-	pentium-* | p5-* | p6-*)
-		# We don't have specific support for the Intel Pentium (p6) followon yet, so just call it a Pentium
+	pentiumpro | p6 | 6x86 | athlon | athlon_*)
+		basic_machine=i686-pc
+		;;
+	pentiumii | pentium2)
+		basic_machine=i686-pc
+		;;
+	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	k5)
-		# We don't have specific support for AMD's K5 yet, so just call it a Pentium
-		basic_machine=i586-amd
-		;;
-	nexen)
-		# We don't have specific support for Nexgen yet, so just call it a Pentium
-		basic_machine=i586-nexgen
+	pentiumpro-* | p6-* | 6x86-* | athlon-*)
+		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pentiumii-* | pentium2-*)
+		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pn)
 		basic_machine=pn-gould
 		;;
-	power)	basic_machine=rs6000-ibm
+	power)	basic_machine=power-ibm
 		;;
 	ppc)	basic_machine=powerpc-unknown
-	        ;;
+		;;
 	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
-	        ;;
+		;;
 	ppcle-* | powerpclittle-*)
 		basic_machine=powerpcle-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
+	ppc64)	basic_machine=powerpc64-unknown
+		;;
+	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
+		basic_machine=powerpc64le-unknown
+		;;
+	ppc64le-* | powerpc64little-*)
+		basic_machine=powerpc64le-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	ps2)
 		basic_machine=i386-ibm
 		;;
+	pw32)
+		basic_machine=i586-unknown
+		os=-pw32
+		;;
+	rom68k)
+		basic_machine=m68k-rom68k
+		os=-coff
+		;;
 	rm[46]00)
 		basic_machine=mips-siemens
 		;;
 	rtpc | rtpc-*)
 		basic_machine=romp-ibm
 		;;
+	s390 | s390-*)
+		basic_machine=s390-ibm
+		;;
+	s390x | s390x-*)
+		basic_machine=s390x-ibm
+		;;
+	sa29200)
+		basic_machine=a29k-amd
+		os=-udi
+		;;
+	sb1)
+		basic_machine=mipsisa64sb1-unknown
+		;;
+	sb1el)
+		basic_machine=mipsisa64sb1el-unknown
+		;;
 	sequent)
 		basic_machine=i386-sequent
 		;;
@@ -466,6 +838,10 @@
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sparclite-wrs | simso-wrs)
+		basic_machine=sparclite-wrs
+		os=-vxworks
+		;;
 	sps7)
 		basic_machine=m68k-bull
 		os=-sysv2
@@ -473,6 +849,13 @@
 	spur)
 		basic_machine=spur-unknown
 		;;
+	st2000)
+		basic_machine=m68k-tandem
+		;;
+	stratus)
+		basic_machine=i860-stratus
+		os=-sysv4
+		;;
 	sun2)
 		basic_machine=m68000-sun
 		;;
@@ -513,10 +896,44 @@
 	sun386 | sun386i | roadrunner)
 		basic_machine=i386-sun
 		;;
+	sv1)
+		basic_machine=sv1-cray
+		os=-unicos
+		;;
 	symmetry)
 		basic_machine=i386-sequent
 		os=-dynix
 		;;
+	t3d)
+		basic_machine=alpha-cray
+		os=-unicos
+		;;
+	t3e)
+		basic_machine=alphaev5-cray
+		os=-unicos
+		;;
+	t90)
+		basic_machine=t90-cray
+		os=-unicos
+		;;
+        tic4x | c4x*)
+		basic_machine=tic4x-unknown
+		os=-coff
+		;;
+	tic54x | c54x*)
+		basic_machine=tic54x-unknown
+		os=-coff
+		;;
+	tx39)
+		basic_machine=mipstx39-unknown
+		;;
+	tx39el)
+		basic_machine=mipstx39el-unknown
+		;;
+	toad1)
+		basic_machine=pdp10-xkl
+		os=-tops20
+		;;
 	tower | tower-32)
 		basic_machine=m68k-ncr
 		;;
@@ -528,6 +945,10 @@
 		basic_machine=a29k-nyu
 		os=-sym1
 		;;
+	v810 | necv810)
+		basic_machine=v810-nec
+		os=-none
+		;;
 	vaxv)
 		basic_machine=vax-dec
 		os=-sysv
@@ -536,6 +957,9 @@
 		basic_machine=vax-dec
 		os=-vms
 		;;
+	vpp*|vx|vx-*)
+		basic_machine=f301-fujitsu
+		;;
 	vxworks960)
 		basic_machine=i960-wrs
 		os=-vxworks
@@ -548,13 +972,29 @@
 		basic_machine=a29k-wrs
 		os=-vxworks
 		;;
-	xmp)
-		basic_machine=xmp-cray
-		os=-unicos
+	w65*)
+		basic_machine=w65-wdc
+		os=-none
+		;;
+	w89k-*)
+		basic_machine=hppa1.1-winbond
+		os=-proelf
+		;;
+	windows32)
+		basic_machine=i386-pc
+		os=-windows32-msvcrt
 		;;
-        xps | xps100)
+	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
+	ymp)
+		basic_machine=ymp-cray
+		os=-unicos
+		;;
+	z8k-*-coff)
+		basic_machine=z8k-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -562,8 +1002,14 @@
 
 # Here we handle the default manufacturer of certain CPU types.  It is in
 # some cases the only manufacturer, in others, it is the most popular.
-	mips)
-		basic_machine=mips-mips
+	w89k)
+		basic_machine=hppa1.1-winbond
+		;;
+	op50n)
+		basic_machine=hppa1.1-oki
+		;;
+	op60c)
+		basic_machine=hppa1.1-oki
 		;;
 	romp)
 		basic_machine=romp-ibm
@@ -574,16 +1020,26 @@
 	vax)
 		basic_machine=vax-dec
 		;;
+	pdp10)
+		# there are many clones, so DEC is not a safe bet
+		basic_machine=pdp10-unknown
+		;;
 	pdp11)
 		basic_machine=pdp11-dec
 		;;
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sparc)
+	sh3 | sh4 | sh3eb | sh4eb | sh[1234]le | sh3ele)
+		basic_machine=sh-unknown
+		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
+	sparc | sparcv9 | sparcv9b)
 		basic_machine=sparc-sun
 		;;
-        cydra)
+	cydra)
 		basic_machine=cydra-cydrome
 		;;
 	orion)
@@ -592,6 +1048,15 @@
 	orion105)
 		basic_machine=clipper-highlevel
 		;;
+	mac | mpw | mac-mpw)
+		basic_machine=m68k-apple
+		;;
+	pmac | pmac-mpw)
+		basic_machine=powerpc-apple
+		;;
+	*-unknown)
+		# Make sure to match an already-canonicalized machine name.
+		;;
 	*)
 		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
 		exit 1
@@ -615,6 +1080,8 @@
 if [ x"$os" != x"" ]
 then
 case $os in
+        # First match some system type aliases
+        # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
@@ -622,34 +1089,74 @@
 	-solaris)
 		os=-solaris2
 		;;
-	-unixware* | svr4*)
+	-svr4*)
 		os=-sysv4
 		;;
+	-unixware*)
+		os=-sysv4.2uw
+		;;
 	-gnu/linux*)
-		os=`echo $os | sed -e 's|gnu/linux|linux|'`
+		os=`echo $os | sed -e 's|gnu/linux|linux-gnu|'`
 		;;
 	# First accept the basic system types.
 	# The portable systems comes first.
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[345]* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
 	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
-	      | -amigados* | -msdos* | -newsos* | -unicos* | -aos* \
-	      | -nindy* | -vxworks* | -ebmon* | -hms* | -mvs* | -clix* \
-	      | -riscos* | -linux* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -netbsd* | -freebsd* | -riscix* \
-	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* \
+	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
+	      | -aos* \
+	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
+	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
+	      | -hiux* | -386bsd* | -netbsd* | -openbsd* | -freebsd* | -riscix* \
+	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
-	      | -udi* | -eabi* | -lites* )
+	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
+	      | -chorusos* | -chorusrdb* \
+	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
+	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -interix* | -uwin* | -rhapsody* | -darwin* | -opened* \
+	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
+	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
+	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
+	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* | -powermax*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
+	-qnx*)
+		case $basic_machine in
+		    x86-* | i*86-*)
+			;;
+		    *)
+			os=-nto$os
+			;;
+		esac
+		;;
+	-nto*)
+		os=-nto-qnx
+		;;
+	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
+		;;
+	-mac*)
+		os=`echo $os | sed -e 's|mac|macos|'`
+		;;
+	-linux*)
+		os=`echo $os | sed -e 's|linux|linux-gnu|'`
+		;;
 	-sunos5*)
 		os=`echo $os | sed -e 's|sunos5|solaris2|'`
 		;;
 	-sunos6*)
 		os=`echo $os | sed -e 's|sunos6|solaris3|'`
 		;;
+	-opened*)
+		os=-openedition
+		;;
+	-wince*)
+		os=-wince
+		;;
 	-osfrose*)
 		os=-osfrose
 		;;
@@ -665,9 +1172,24 @@
 	-acis*)
 		os=-aos
 		;;
+	-atheos*)
+		os=-atheos
+		;;
+	-386bsd)
+		os=-bsd
+		;;
 	-ctix* | -uts*)
 		os=-sysv
 		;;
+	-nova*)
+		os=-rtmk-nova
+		;;
+	-ns2 )
+		os=-nextstep2
+		;;
+	-nsk*)
+		os=-nsk
+		;;
 	# Preserve the version number of sinix5.
 	-sinix5.*)
 		os=`echo $os | sed -e 's|sinix|sysv|'`
@@ -693,9 +1215,18 @@
 	# This must come after -sysvr4.
 	-sysv*)
 		;;
+	-ose*)
+		os=-ose
+		;;
+	-es1800*)
+		os=-ose
+		;;
 	-xenix)
 		os=-xenix
 		;;
+	-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+		os=-mint
+		;;
 	-none)
 		;;
 	*)
@@ -721,10 +1252,17 @@
 	*-acorn)
 		os=-riscix1.2
 		;;
+	arm*-rebel)
+		os=-linux
+		;;
 	arm*-semi)
 		os=-aout
 		;;
-        pdp11-*)
+	# This must come before the *-dec entry.
+	pdp10-*)
+		os=-tops20
+		;;
+	pdp11-*)
 		os=-none
 		;;
 	*-dec | vax-*)
@@ -742,15 +1280,39 @@
 		# default.
 		# os=-sunos4
 		;;
+	m68*-cisco)
+		os=-aout
+		;;
+	mips*-cisco)
+		os=-elf
+		;;
+	mips*-*)
+		os=-elf
+		;;
+	or32-*)
+		os=-coff
+		;;
 	*-tti)	# must be before sparc entry or we get the wrong os.
 		os=-sysv3
 		;;
 	sparc-* | *-sun)
 		os=-sunos4.1.1
 		;;
+	*-be)
+		os=-beos
+		;;
 	*-ibm)
 		os=-aix
 		;;
+	*-wec)
+		os=-proelf
+		;;
+	*-winbond)
+		os=-proelf
+		;;
+	*-oki)
+		os=-proelf
+		;;
 	*-hp)
 		os=-hpux
 		;;
@@ -761,7 +1323,7 @@
 		os=-sysv
 		;;
 	*-cbm)
-		os=-amigados
+		os=-amigaos
 		;;
 	*-dg)
 		os=-dgux
@@ -775,6 +1337,9 @@
 	m88k-omron*)
 		os=-luna
 		;;
+	*-next )
+		os=-nextstep
+		;;
 	*-sequent)
 		os=-ptx
 		;;
@@ -790,24 +1355,39 @@
 	*-next)
 		os=-nextstep3
 		;;
-        *-gould)
+	*-gould)
 		os=-sysv
 		;;
-        *-highlevel)
+	*-highlevel)
 		os=-bsd
 		;;
 	*-encore)
 		os=-bsd
 		;;
-        *-sgi)
+	*-sgi)
 		os=-irix
 		;;
-        *-siemens)
+	*-siemens)
 		os=-sysv4
 		;;
 	*-masscomp)
 		os=-rtu
 		;;
+	f30[01]-fujitsu | f700-fujitsu)
+		os=-uxpv
+		;;
+	*-rom68k)
+		os=-coff
+		;;
+	*-*bug)
+		os=-coff
+		;;
+	*-apple)
+		os=-macos
+		;;
+	*-atari*)
+		os=-mint
+		;;
 	*)
 		os=-none
 		;;
@@ -826,15 +1406,18 @@
 			-sunos*)
 				vendor=sun
 				;;
-			-lynxos*)
-				vendor=lynx
-				;;
 			-aix*)
 				vendor=ibm
 				;;
+			-beos*)
+				vendor=be
+				;;
 			-hpux*)
 				vendor=hp
 				;;
+			-mpeix*)
+				vendor=hp
+				;;
 			-hiux*)
 				vendor=hitachi
 				;;
@@ -850,18 +1433,41 @@
 			-genix*)
 				vendor=ns
 				;;
-			-mvs*)
+			-mvs* | -opened*)
 				vendor=ibm
 				;;
 			-ptx*)
 				vendor=sequent
 				;;
-			-vxworks*)
+			-vxsim* | -vxworks* | -windiss*)
 				vendor=wrs
 				;;
+			-aux*)
+				vendor=apple
+				;;
+			-hms*)
+				vendor=hitachi
+				;;
+			-mpw* | -macos*)
+				vendor=apple
+				;;
+			-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+				vendor=atari
+				;;
+			-vos*)
+				vendor=stratus
+				;;
 		esac
 		basic_machine=`echo $basic_machine | sed "s/unknown/$vendor/"`
 		;;
 esac
 
 echo $basic_machine$os
+exit 0
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "timestamp='"
+# time-stamp-format: "%:y-%02m-%02d"
+# time-stamp-end: "'"
+# End:
--- a/config/linux-shared.mk
+++ b/config/linux-shared.mk
@@ -34,7 +34,7 @@
 install:: ${SHARED_LIB}
 	${INSTALL} ${SHARED_LIB} ${lib_dir}
 	rm -f ${lib_dir}/lib${lib_name}.so
-	ln -s ${lib_dir}/lib${lib_name}.so.${major_shared}.${minor_shared} ${lib_dir}/lib${lib_name}.so
+	ln -s lib${lib_name}.so.${major_shared}.${minor_shared} ${lib_dir}/lib${lib_name}.so
 
 clean::
 	rm -f ${SHARED_LIB} ${SHARED_DIR}/lib${lib_name}.so ${SH_OBJS}
--- a/configure
+++ b/configure
@@ -2571,24 +2571,28 @@
 if test "x$no_motif" = xno ; then
   GUI_SUFFIX=_motif
   GUI=wx_motif
-  gui_libraries="-lXm $x_libraries -lXt -lX11 -lXext"
-  echo $ac_n "checking for main in -lXmu""... $ac_c" 1>&6
-echo "configure:2577: checking for main in -lXmu" >&5
-ac_lib_var=`echo Xmu'_'main | sed 'y%./+-%__p_%'`
+  gui_libraries="$x_libraries -lXt -lX11 -lXext"
+  echo $ac_n "checking for XmuCvtStringToBitmap in -lXmu""... $ac_c" 1>&6
+echo "configure:2577: checking for XmuCvtStringToBitmap in -lXmu" >&5
+ac_lib_var=`echo Xmu'_'XmuCvtStringToBitmap | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lXmu  $LIBS"
+LIBS="-lXmu $gui_libraries  $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 2585 "configure"
 #include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char XmuCvtStringToBitmap();
 
 int main() {
-main()
+XmuCvtStringToBitmap()
 ; return 0; }
 EOF
-if { (eval echo configure:2592: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2596: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2603,9 +2607,10 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  gui_libraries="$gui_libraries -lXmu"
+  gui_libraries="-lXm -lXmu $gui_libraries"
 else
   echo "$ac_t""no" 1>&6
+gui_libraries="-lXm $gui_libraries"
 fi
 
   sb_scrol=
@@ -2660,7 +2665,7 @@
 fi
 
 echo $ac_n "checking host system type""... $ac_c" 1>&6
-echo "configure:2664: checking host system type" >&5
+echo "configure:2669: checking host system type" >&5
 
 host_alias=$host
 case "$host_alias" in
@@ -3033,7 +3038,7 @@
 
 
 major_shared=1
-minor_shared=66
+minor_shared=68
 
 
 
--- a/configure.in
+++ b/configure.in
@@ -231,8 +231,10 @@
 if test "x$no_motif" = xno ; then
   GUI_SUFFIX=_motif
   GUI=wx_motif
-  gui_libraries="-lXm $x_libraries -lXt -lX11 -lXext"
-  AC_CHECK_LIB(Xmu, main, [gui_libraries="$gui_libraries -lXmu"])
+  gui_libraries="$x_libraries -lXt -lX11 -lXext"
+  AC_CHECK_LIB(Xmu, XmuCvtStringToBitmap,
+              [gui_libraries="-lXm -lXmu $gui_libraries"],
+              [gui_libraries="-lXm $gui_libraries"], $gui_libraries )
   sb_scrol=
   xmgauge="xmgauge"
   xmgauge_lib="-lgauge_motif"
@@ -650,7 +652,7 @@
 dnl shared libraries
 
 major_shared=1
-minor_shared=66
+minor_shared=68
 
 AC_SUBST(shared_make)
 AC_SUBST(SH_OBJS)
--- a/contrib/Makefile.in
+++ b/contrib/Makefile.in
@@ -7,10 +7,10 @@
 
 @SET_MAKE@
 
-libsubdirs=wxxpm/libxpm.34b/lib wxstring @xmgauge@ @xmcombo@
+libsubdirs=wxstring @xmgauge@ @xmcombo@
 demodirs=wxstring @xmgauge@ @xmcombo@
-instdirs=wxxpm/libxpm.34b/lib
-cleandirs=wxxpm/libxpm.34b/lib wxstring @xmgauge@ @xmcombo@
+instdirs=
+cleandirs=wxstring @xmgauge@ @xmcombo@
 
 all: lib 
 
--- a/contrib/combobox/combobox.h
+++ b/contrib/combobox/combobox.h
@@ -34,7 +34,7 @@
 extern "C" {
 #endif
 
-#define XmNselectionCallback		"selectionCallback"
+// #define XmNselectionCallback		"selectionCallback"
 #define XmCSelectionCallback		"SelectionCallback"
 #define XmNunselectionCallback		"unselectionCallback"
 #define XmCUnselectionCallback		"UnselectionCallback"
--- a/contrib/wxstring/wxregex.cpp
+++ b/contrib/wxstring/wxregex.cpp
@@ -38,7 +38,7 @@
 #ifdef __GNUG__
 #pragma implementation
 #ifndef GNUWIN32
-#include <std.h>
+// #include <std.h>
 #endif
 
 //#include <builtin.h>
@@ -50,14 +50,20 @@
 #pragma warning( disable : 4135 4018 )
 #endif
 
+#include "wx_defs.h"
 #if !defined(USE_IOSTREAM) || USE_IOSTREAMH
 #include <iostream.h>
 #else
 #include <iostream>
+using std::cerr;
 #endif
 
 #include <ctype.h>
+#if USE_NEWH
 #include <new.h>
+#else
+#include <new>
+#endif
 #include <string.h>
 
 #ifdef __DECCXX
@@ -214,7 +220,9 @@
 
 /* AIX requires the alloca decl to be the first thing in the file. */
 #if defined(__GNUC__)
+#if !defined(alloca)
 #define alloca __builtin_alloca
+#endif
 #else
 #if defined(sparc) || defined(__sgi) || defined(__DECCXX) && !defined(VMS)
 #include <alloca.h>
@@ -1335,7 +1343,7 @@
                 }
               /* Can't back reference to a subexpression if inside of it.  */
               for (stackt = stackp - 2;  stackt > stackb;  stackt -= 4)
- 		if (*stackt == c1)
+ 		if ((*stackt == c1))
 		  goto normal_char;
 	      laststart = b;
 	      BUFPUSH (duplicate);
@@ -2392,10 +2400,10 @@
 	case charset:
 	case charset_not:
 	  {
-	    int not = 0;	    /* Nonzero for charset_not.  */
+	    int not_ = 0;	    /* Nonzero for charset_not.  */
 	    register int c;
 	    if (*(p - 1) == (unsigned char) charset_not)
-	      not = 1;
+	      not_ = 1;
 
 	    PREFETCH;	    /* Fetch a data character. */
 
@@ -2406,11 +2414,11 @@
 
 	    if (c < *p * BYTEWIDTH
 		&& p[1 + c / BYTEWIDTH] & (1 << (c % BYTEWIDTH)))
-	      not = !not;
+	      not_ = !not_;
 
 	    p += 1 + *p;
 
-	    if (!not) goto fail;
+	    if (!not_) goto fail;
 	    SET_REGS_MATCHED;
             d++;
 	    break;
@@ -2480,13 +2488,13 @@
 		else if (p1[3] == (unsigned char) charset
 			 || p1[3] == (unsigned char) charset_not)
 		  {
-		    int not = p1[3] == (unsigned char) charset_not;
+		    int not_ = p1[3] == (unsigned char) charset_not;
 		    if (c < p1[4] * BYTEWIDTH
 			&& p1[5 + c / BYTEWIDTH] & (1 << (c % BYTEWIDTH)))
-		      not = !not;
+		      not_ = !not_;
 		    /* `not' is 1 if c would match.  */
 		    /* That means it is not safe to finalize.  */
-		    if (!not)
+		    if (!not_)
 		      p[-3] = (unsigned char) finalize_jump;
 		  }
 	      }
@@ -2709,7 +2717,7 @@
       if (stackp != stackb)
 	/* A restart point is known.  Restart there and pop it. */
 	{
-          short last_used_reg, this_reg;
+          long last_used_reg, this_reg;
           
           /* If this failure point is from a dummy_failure_point, just
              skip it.  */
@@ -2724,7 +2732,7 @@
           if (d >= string1 && d <= end1)
 	    dend = end_match_1;
           /* Restore register info.  */
-          last_used_reg = (short) (int) *--stackp;
+          last_used_reg = (long) *--stackp;
           
           /* Make the ones that weren't saved -1 or 0 again.  */
           for (this_reg = wxRE_NREGS - 1; this_reg > last_used_reg; this_reg--)
--- a/contrib/wxstring/wxstrgnu.cpp
+++ b/contrib/wxstring/wxstrgnu.cpp
@@ -66,7 +66,11 @@
 #include <assert.h>
 #include <ctype.h>
 #include <limits.h>
+#if USE_NEWH
 #include <new.h>
+#else
+#include <new>
+#endif
 //#include <builtin.h>
                                                    
 //********************************************************************************
@@ -1486,7 +1490,7 @@
   for (; p < e; ++p)
   {
     int at_word;
-    if (at_word = islower(*p))
+    if ((at_word = islower(*p)))
       *p = toupper(*p);
     else 
       at_word = isupper(*p) || isdigit(*p);
@@ -1621,7 +1625,11 @@
 
 istream& operator>>(istream& s, wxString& x)
 {
-  if (!s.ipfx(0) || (!(s.flags() & ios::skipws) && !ws(s)))
+  if (
+#if GCC_VERSION < 30200
+      !s.ipfx(0) ||
+#endif
+      (!(s.flags() & ios::skipws) && !ws(s)))
   {
     s.clear(ios::failbit|s.rdstate()); // Redundant if using GNU iostreams.
     return s;
@@ -1643,14 +1651,16 @@
   int new_state = s.rdstate();
   if (i == 0) new_state |= ios::failbit;
   if (ch == EOF) new_state |= ios::eofbit;
-  s.clear(new_state);
+  s.clear((std::_Ios_Iostate)new_state);
   return s;
 }
 
 int Readline(istream& s, wxString& x, char terminator, int discard)
 {
+#if GCC_VERSION < 30200
   if (!s.ipfx(0))
     return 0;
+#endif
   int ch;
   int i = 0;
   x.rep = Sresize(x.rep, 80);
--- a/contrib/wxstring/wxstrgnu.h
+++ b/contrib/wxstring/wxstrgnu.h
@@ -58,6 +58,12 @@
 #include <iostream.h>
 #else
 #include <iostream>
+using std::cin;
+using std::cout;
+using std::cerr;
+using std::istream;
+using std::ios;
+using std::streambuf;
 #endif
 #include <stdio.h> // for Readline
 
@@ -153,7 +159,6 @@
 #ifdef __BORLANDC__
 #pragma warn -inl
 #endif
-
 class WXDLLEXPORT wxString
   : public wxObject
 {
@@ -207,13 +212,13 @@
 
   wxString&         Append(const char* cs){ return(*this += cs); }
   wxString&         Append(const wxString& s){ return(*this += s); }
-  wxString&         Append(char c, int rep=1){ return(*this += Replicate(c,rep)); }   // Append c rep times
+  wxString&         Append(char c, int rep=1);
 
   inline wxString&  Prepend(const wxString&     y); 
   wxString&         Prepend(const wxSubString&  y);
   wxString&         Prepend(const char* t);
   wxString&         Prepend(char        c);
-  wxString&         Prepend(char c, int rep=1){ Prepend(Replicate(c,rep)); return(*this); }  // Prepend c rep times
+  wxString&         Prepend(char c, int rep=1);
                                           
 // procedural versions:
 // concatenate first 2 args, store result in last arg
@@ -525,6 +530,10 @@
 #define wxCHARARG(s) ((char *)(s).Chars())  
 };
 
+wxString Replicate(char c, int n);
+inline wxString& wxString::Append(char c, int rep){ return(*this += Replicate(c,rep)); }   // Append c rep times
+inline wxString& wxString::Prepend(char c, int rep){ Prepend(Replicate(c,rep)); return(*this); }  // Prepend c rep times
+
 typedef wxString StrTmp; // for backward compatibility
 
 // other externs
--- a/contrib/wxxpm/makefile.unx
+++ b/contrib/wxxpm/makefile.unx
@@ -148,9 +148,6 @@
 clean_ol:
 	$(MAKE) -f makefile.unx GUISUFFIX=_ol cleanany
 
-clean_ol:
-	$(MAKE) -f makefile.unx GUISUFFIX=_ol cleanany
-
 clean_hp:
 	$(MAKE) -f makefile.unx GUISUFFIX=_hp cleanany
 
--- a/include/base/wb_cmdlg.h
+++ b/include/base/wb_cmdlg.h
@@ -266,7 +266,7 @@
 // Returns wxYES/NO/OK/CANCEL
 
 WXDLLEXPORT extern Constdata char *wxMessageBoxCaptionStr;
-WXDLLEXPORT int wxbMessageBox(Const char *message, Constdata char *caption = wxMessageBoxCaptionStr, long style = wxOK|wxCENTRE,
+WXDLLEXPORT int wxbMessageBox(const char *message, const char *caption = wxMessageBoxCaptionStr, long style = wxOK|wxCENTRE,
   wxWindow *parent = NULL, int x = -1, int y = -1);
 
 #define wxOPEN 1
--- a/include/base/wb_dc.h
+++ b/include/base/wb_dc.h
@@ -19,7 +19,14 @@
 #endif
 
 #ifndef IN_CPROTO
+#if USE_IOSTREAMH
 #include <fstream.h>
+#else
+#include <fstream>
+using std::streambuf;
+using std::ofstream;
+using std::ostream;
+#endif
 #endif
 #include "wx_defs.h"
 #include "wx_frame.h"
--- a/include/base/wb_dccan.h
+++ b/include/base/wb_dccan.h
@@ -18,7 +18,11 @@
 #endif
 
 #ifndef IN_CPROTO
+#if USE_IOSTREAMH
 #include <fstream.h>
+#else
+#include <fstream>
+#endif
 #endif
 
 #include "wx_defs.h"
--- a/include/base/wb_dcmem.h
+++ b/include/base/wb_dcmem.h
@@ -18,7 +18,11 @@
 #endif
 
 #ifndef IN_CPROTO
+#if USE_IOSTREAMH
 #include <fstream.h>
+#else
+#include <fstream>
+#endif
 #endif
 #include "wx_dc.h"
 #include "wx_dccan.h"
--- a/include/base/wb_text.h
+++ b/include/base/wb_text.h
@@ -24,6 +24,7 @@
 #include <iostream.h>
 #else
 #include <iostream>
+using std::streambuf;
 #endif
 
 #ifdef IN_CPROTO
--- a/include/base/wb_txt.h
+++ b/include/base/wb_txt.h
@@ -38,7 +38,7 @@
   ~wxbText(void);
 
   virtual char *GetValue(void) = 0;
-  virtual void SetValue(char *value) = 0;
+  virtual void SetValue(const char *value) = 0;
 
   // Clipboard operations
   virtual void Copy(void) = 0;
--- a/include/base/wx_doc.h
+++ b/include/base/wx_doc.h
@@ -37,9 +37,6 @@
 class wxCommandProcessor;
 class wxFileHistory;
 
-class ostream;
-class istream;
-
 // Document manager flags
 #define wxDOC_SDI       1
 #define wxDOC_MDI       2
--- a/include/base/wx_mem.h
+++ b/include/base/wx_mem.h
@@ -40,6 +40,8 @@
 #include <iostream.h>
 #else
 #include <iostream>
+using std::streambuf;
+using std::ostream;
 #endif
 
 #define WXDEBUG_NEW new(__FILE__,__LINE__)
--- a/include/base/wx_obj.h
+++ b/include/base/wx_obj.h
@@ -150,6 +150,8 @@
 
 // Template version
 #include <iostream>
+using std::istream;
+using std::ostream;
 
 #endif
 
--- a/include/base/wx_setup.h
+++ b/include/base/wx_setup.h
@@ -145,7 +145,16 @@
 #define REMOVE_UNUSED_ARG 1
                                   // Set this to 0 if your compiler can't cope
                                   // with omission of prototype parameters.
-#define USE_IOSTREAMH     1
+#define GCC_VERSION (__GNUC__*10000+__GNUC_MINOR__*100+__GNUC_PATCHLEVEL__)
+#if GCC_VERSION < 30200
+#define USE_IOSTREAMH   1
+#define USE_NEWH        1
+#else
+#define USE_IOSTREAMH   0
+#define USE_NEWH        0
+#define USE_IOSTREAM
+#define _G_NO_NRV
+#endif
                                   // VC++ 4.2 and above allows <iostream> and <iostream.h>
                                   // but you can't mix them. Set to 1 for <iostream.h>,
                                   // 0 for <iostream>
--- a/include/base/wx_sysev.h
+++ b/include/base/wx_sysev.h
@@ -27,6 +27,7 @@
 #include <iostream.h>
 #else
 #include <iostream>
+using std::istream;
 #endif
 
 #endif
--- a/include/base/wx_utils.h
+++ b/include/base/wx_utils.h
@@ -26,6 +26,9 @@
 #include <iostream.h>
 #else
 #include <iostream>
+using std::streambuf;
+using std::cerr;
+using std::cout;
 #endif
 
 // ITA change - these are only defined in MSL for Be OS and Power TV
--- a/include/x/wx_cmdlg.h
+++ b/include/x/wx_cmdlg.h
@@ -24,7 +24,7 @@
 
 #define ORPHAN_PARENT NULL
 
-int wxMessageBox(char *message, char *caption = "Message", long style = wxOK|wxCENTRE,
+int wxMessageBox(const char *message, const char *caption = "Message", long style = wxOK|wxCENTRE,
   wxWindow *parent = ORPHAN_PARENT, int x = -1, int y = -1);
 
 #endif
--- a/include/x/wx_txt.h
+++ b/include/x/wx_txt.h
@@ -45,7 +45,7 @@
          int x = -1, int y = -1, int width = -1, int height = -1,
          long style = 0, char *name = "text");
   char *GetValue(void);
-  void SetValue(char *value);
+  void SetValue(const char *value);
   void SetSize(int x, int y, int width, int height, int sizeFlags = wxSIZE_AUTO);
   void SetClientSize(int width, int height);
   void SetSize(int width, int height) { wxItem::SetSize(width, height); }
--- a/make.rule
+++ b/make.rule
@@ -81,7 +81,7 @@
 #
 ${PROG} : $(OBJS)
 ifneq ($(GUI_OBJ),)
-	${CXX} ${LDFLAGS} ${CXXFLAGS} ${OBJS} -o ${PROG} ${link_dir}\
+	${CXX} ${LDFLAGS} ${CXXFLAGS} ${OBJS} -o ${PROG} ${link_dir} \
 	${local_lib} ${wx_lib} ${gui_libraries} ${extra_lib} ${math_lib}
 else
 	${CXX} ${LDFLAGS} ${CXXFLAGS} ${OBJS} -o ${PROG} ${link_dir}\
--- a/src/base/wb_cmdlg.cpp
+++ b/src/base/wb_cmdlg.cpp
@@ -1017,7 +1017,7 @@
  *
  */
 
-void wxSplitMessage(Const char *message, wxList *messageList, wxPanel *panel)
+void wxSplitMessage(const char *message, wxList *messageList, wxPanel *panel)
 {
   char *copyMessage = copystring(message);
   size_t i = 0;
@@ -1557,7 +1557,7 @@
 }
 
 // Pop up a message box: generic version used by X.
-int wxbMessageBox(Const char *message, Constdata char *caption, long type,
+int wxbMessageBox(const char *message, const char *caption, long type,
                  wxWindow *parent, int x, int y)
 {
   wxBeginBusyCursor();
--- a/src/base/wb_gdi.cpp
+++ b/src/base/wb_gdi.cpp
@@ -1132,7 +1132,7 @@
 
   table->BeginFind();
 
-  while (node = table->Next())
+  while ((node = table->Next()))
     delete (wxFontNameItem *)node->Data();
 }
 
@@ -1502,7 +1502,7 @@
 {
   int id;
 
-  if (id = GetFontId(name))
+  if ((id = GetFontId(name)))
     return id;
 
   id = GetNewFontId();
@@ -1578,7 +1578,7 @@
 
   table->BeginFind();
 
-  while (node = table->Next()) {
+  while ((node = table->Next())) {
     wxFontNameItem *item = (wxFontNameItem *)node->Data();
     if (!strcmp(name, item->name))
       return item->id;
--- a/src/base/wb_ps.cpp
+++ b/src/base/wb_ps.cpp
@@ -52,11 +52,12 @@
 // VC++ 4.2 and above use a different iostream scheme
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
 #endif
 
-#include <fstream.h>
 #include <math.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -181,7 +182,7 @@
 	{
 		float w, h;
 		GetSize(&w, &h);
-		yorigin = h;
+		yorigin = (int)h;
 	}
 
   min_x = (float)1000.0;
@@ -248,7 +249,7 @@
 	{
 		float w, h;
 		GetSize(&w, &h);
-		yorigin = h;
+		yorigin = (int)h;
 	}
 
   min_x = (float)1000.0;
--- a/src/base/wb_res.cpp
+++ b/src/base/wb_res.cpp
@@ -246,7 +246,7 @@
     // parent's child list.
     BeginFind();
     wxNode *node = NULL;
-    while (node = Next())
+    while ((node = Next()))
     {
       wxItemResource *parent = (wxItemResource *)node->Data();
       if (parent->GetChildren().Member(item))
@@ -1791,7 +1791,7 @@
   int i = 0;
   char *word;
   long bitList = 0;
-  while (word = wxResourceParseWord(bitListString, &i))
+  while ((word = wxResourceParseWord(bitListString, &i)))
   {
     Bool found = FALSE;
     int j;
--- a/src/base/wb_text.cpp
+++ b/src/base/wb_text.cpp
@@ -43,7 +43,7 @@
 #ifdef wx_msw
   font->UseResource();
 #endif
-#ifndef NO_TEXT_WINDOW_STREAM
+#if !defined(NO_TEXT_WINDOW_STREAM) && GCC_VERSION < 30200
   if( allocate() != EOF) setp(base(),ebuf());
 #endif
 }
@@ -64,7 +64,7 @@
   font->UseResource();
 #endif
 
-#ifndef NO_TEXT_WINDOW_STREAM
+#if !defined(NO_TEXT_WINDOW_STREAM) && GCC_VERSION < 30200
   if( allocate()!= EOF) setp(base(),ebuf());
 #endif
 }
@@ -95,12 +95,13 @@
 int wxbTextWindow::overflow(int c)
 {
   // Make sure there is a holding area
+#if GCC_VERSION < 30200
   if ( allocate()==EOF )
   {
     wxError("Streambuf allocation failed","Internal error");
     return EOF;
   }
-  
+#endif  
   // Verify that there are no characters in get area
   if ( gptr() && gptr() < egptr() )
   {
@@ -112,12 +113,13 @@
   setg(0,0,0);
 
   // Make sure there is a put area
+#if GCC_VERSION < 30200
   if ( ! pptr() )
   {
     wxError("Put area not opened","Internal error");
     setp( base(), base() );
   }
-
+#endif
 
   // Determine how many characters have been inserted but no consumed
   int plen = pptr() - pbase();
--- a/src/base/wb_utils.cpp
+++ b/src/base/wb_utils.cpp
@@ -30,11 +30,12 @@
 
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
 #endif
 
-#include <fstream.h>
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -669,10 +670,10 @@
 #endif
 
     /* Expand inline environment variables */
-    while (*d++ = *s) {
+    while ((*d++ = *s)) {
 #ifndef wx_msw
 	if (*s == '\\') {
-	    if (*(d - 1) = *++s) {
+	    if ((*(d - 1) = *++s)) {
 		s++;
 		continue;
 	    } else
@@ -686,9 +687,9 @@
 #endif
 	{
 	    register char  *start = d;
-	    register        braces = (*s == '{' || *s == '(');
+	    register int    braces = (*s == '{' || *s == '(');
 	    register char  *value;
-	    while (*d++ = *s)
+	    while ((*d++ = *s))
 		if (braces ? (*s == '}' || *s == ')') : !(isalnum(*s) || *s == '_') )
 		    break;
 		else
@@ -696,7 +697,7 @@
 	    *--d = 0;
 	    value = getenv(braces ? start + 1 : start);
 	    if (value) {
-		for (d = start - 1; *d++ = *value++;);
+		for (d = start - 1; (*d++ = *value++););
 		d--;
 		if (braces && *s)
 		    s++;
@@ -746,7 +747,7 @@
 	  *(d - 1) = SEP;
     }
     s = nm;
-    while (*d++ = *s++);
+    while ((*d++ = *s++));
 
     delete[] nm_tmp; // clean up alloc
     /* Now clean up the buffer */
@@ -1219,7 +1220,9 @@
 
 wxDebugStreamBuf::wxDebugStreamBuf(void)
 {
+#if USE_IOSTREAMH && GCC_VERSION < 30200
   if (allocate()) setp(base(),ebuf());
+#endif
 }
 
 int wxDebugStreamBuf::overflow(int WXUNUSED(i))
--- a/src/base/wb_win.cpp
+++ b/src/base/wb_win.cpp
@@ -500,7 +500,7 @@
 #else
     char *windowClass = "unknown";
 #endif
-    char *winName = (GetName() ? GetName() : "unnamed");
+    const char *winName = (GetName() ? GetName() : "unnamed");
     wxDebugMsg("Constraint(s) not satisfied for window of type %s, name %s:\n", windowClass, winName);
     if (!constr->left.GetDone())
       wxDebugMsg("  unsatisfied 'left' constraint.\n");
--- a/src/base/wx_doc.cpp
+++ b/src/base/wx_doc.cpp
@@ -42,12 +42,14 @@
 
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
+using std::ifstream;
+using std::ofstream;
 #endif
 
-#include "fstream.h"
-
 // wxDocManager *wxTheDocManager = NULL;
 
 /*
@@ -247,7 +249,7 @@
   if (!file)
     return FALSE;
 
-  char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "File error";
+  const char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "File error";
 
   ofstream store(file);
   if (store.fail() || store.bad())
@@ -274,7 +276,7 @@
   if (!OnSaveModified())
     return FALSE;
 
-  char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "File error";
+  const char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "File error";
 
   ifstream store(file);
   if (store.fail() || store.bad())
@@ -409,7 +411,7 @@
     char title[300];
     GetPrintableName(title);
 
-    char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "Warning";
+    const char *msgTitle = wxTheApp->GetAppName() ? wxTheApp->GetAppName() : "Warning";
 
     sprintf(buf, "Do you want to save changes to document %s?", title);
     int res = wxMessageBox(buf, msgTitle, wxYES_NO|wxCANCEL|wxICON_QUESTION,
--- a/src/base/wx_mem.cpp
+++ b/src/base/wx_mem.cpp
@@ -40,10 +40,12 @@
 // VC++ 4.2 and above use a different iostream scheme
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
+using std::ofstream;
 #endif
-#include <fstream.h>
 
 #if !defined(__WATCOMC__) && !defined(VMS) && !defined(__MWERKS__) && !defined(__GNUG__)
 #include <memory.h>
--- a/src/base/wx_split.cpp
+++ b/src/base/wx_split.cpp
@@ -132,7 +132,7 @@
 
 	if (event.LeftDown())
 	{
-        if ( SashHitTest(x, y) )
+        if ( SashHitTest((int)x, (int)y) )
         {
 	        CaptureMouse();
 
@@ -146,8 +146,8 @@
             // decision for the Dragging() branch, to ensure
             // the user has dragged a little bit.
             m_dragMode = wxSPLIT_DRAG_LEFT_DOWN;
-            m_firstX = x;
-            m_firstY = y;
+            m_firstX = (int)x;
+            m_firstY = (int)y;
         }
 	}
     else if ( event.LeftUp() && m_dragMode == wxSPLIT_DRAG_LEFT_DOWN )
@@ -199,7 +199,7 @@
             }
             else
             {
-                newSashPosition = x;
+                newSashPosition = (int)x;
             }
         }
         else
@@ -229,7 +229,7 @@
             }
             else
             {
-                newSashPosition = y;
+                newSashPosition = (int)y;
             }
         }
         SetSashPosition(newSashPosition, TRUE);
@@ -237,7 +237,7 @@
 	else if (event.Moving() && !event.Dragging())
 	{
         // Just change the cursor if required
-        if ( SashHitTest(x, y) )
+        if ( SashHitTest((int)x, (int)y) )
         {
             	if ( m_splitMode == wxSPLIT_VERTICAL )
                 {
@@ -253,7 +253,7 @@
         }
 	}
 	else if ( (event.Dragging() && (m_dragMode == wxSPLIT_DRAG_DRAGGING)) ||
-              (event.Dragging() && SashHitTest(x, y, 4)) )
+              (event.Dragging() && SashHitTest((int)x, (int)y, 4)) )
 	{
          if ( m_splitMode == wxSPLIT_VERTICAL )
          {
@@ -271,7 +271,7 @@
                 (abs((int)x - m_firstX) > 1 || abs((int)y - m_firstY) > 1) )
         {
             m_dragMode = wxSPLIT_DRAG_DRAGGING;
-            DrawSashTracker(x, y);
+            DrawSashTracker((int)x, (int)y);
         }
         else
         {
@@ -281,15 +281,15 @@
             DrawSashTracker(m_oldX, m_oldY);
 
             // Draw new one
-            DrawSashTracker(x, y);
+            DrawSashTracker((int)x, (int)y);
           }
         }
-        m_oldX = x;
-        m_oldY = y;
+        m_oldX = (int)x;
+        m_oldY = (int)y;
 	}
     else if ( event.LeftDClick() )
     {
-        OnDoubleClickSash(x, y);
+        OnDoubleClickSash((int)x, (int)y);
     }
     else
     {
--- a/src/base/wx_time.cpp
+++ b/src/base/wx_time.cpp
@@ -33,12 +33,12 @@
 
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <iomanip.h>
 #else
 #include <iostream>
+#include <iomanip>
 #endif
 
-#include <iomanip.h>
-
 extern Bool wxGetLocalTime(long *timeZone, int *dstObserved);
 extern long wxGetCurrentTime(void);
 
--- a/src/x/wx_cmdlg.cpp
+++ b/src/x/wx_cmdlg.cpp
@@ -79,7 +79,7 @@
  */
 
 // Pop up a message box
-int wxMessageBox(char *message, char *caption, long style,
+int wxMessageBox(const char *message, const char *caption, long style,
                  wxWindow *parent, int x, int y)
 {
 #if defined(wx_xview) && USE_NOTICES
--- a/src/x/wx_dc.cpp
+++ b/src/x/wx_dc.cpp
@@ -62,10 +62,11 @@
 
 #if USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
 #endif
-#include <fstream.h>
 
 #include "bdiag.xbm"
 #include "fdiag.xbm"
--- a/src/x/wx_dialg.cpp
+++ b/src/x/wx_dialg.cpp
@@ -1058,7 +1058,7 @@
       XtAddGrab(dialogShell, TRUE, FALSE);
       XEvent event;
 
-      while ((wxModalShowingStack.Number() > 0) && (Bool)wxModalShowingStack.First()->Data())
+      while ((wxModalShowingStack.Number() > 0) && wxModalShowingStack.First()->Data())
       {
         XtAppProcessEvent(wxTheApp->appContext, XtIMAll);
       }
--- a/src/x/wx_gdi.cpp
+++ b/src/x/wx_gdi.cpp
@@ -43,7 +43,7 @@
 #endif
 #endif
 
-const DISPLAY_DPI = 100;
+const int DISPLAY_DPI = 100;
 
 #ifdef wx_x
 XFontPool *wxFontPool = NULL;
@@ -1223,12 +1223,7 @@
 #ifdef wx_xview
   Xv_Cursor x_cursor = NULL;
 #elif defined(wx_motif)
-  Cursor x_cursor =
-#ifdef VMS
-    0;
-#else
-    NULL;
-#endif
+  Cursor x_cursor = 0;
 #endif
   
   switch (cursor_type)
@@ -1713,7 +1708,7 @@
   image->bytes_per_line = (the_width + 7) >> 3;
 
   char tmp[128];
-  sprintf (tmp, "Im%x", (unsigned int)image);
+  sprintf (tmp, "Im%lx", (unsigned long)image);
   XmInstallImage (image, tmp);
 
   // Build our manually stipped pixmap.
@@ -1741,7 +1736,7 @@
   insensImage->bitmap_pad = 8;
   insensImage->bytes_per_line = bpl;
 
-  sprintf (tmp, "Not%x", (unsigned int)insensImage);
+  sprintf (tmp, "Not%lx", (unsigned long)insensImage);
   XmInstallImage (insensImage, tmp);
 #endif
 #ifdef wx_xview
@@ -2276,7 +2271,7 @@
 #endif
 
   char tmp[128];
-  sprintf (tmp, "Im%x", (unsigned int)image);
+  sprintf (tmp, "Im%lx", (unsigned long)image);
 
   Pixel fg, bg;
 
@@ -2303,7 +2298,7 @@
 #endif
 
   char tmp[128];
-  sprintf (tmp, "Im%x", (unsigned int)image);
+  sprintf (tmp, "Im%lx", (unsigned long)image);
 
   Pixel fg, bg;
 
@@ -2332,7 +2327,7 @@
 #endif
 
   char tmp[128];
-  sprintf (tmp, "Not%x", (unsigned int)insensImage);
+  sprintf (tmp, "Not%lx", (unsigned long)insensImage);
 
   Pixel fg, bg;
 
--- a/src/x/wx_ipc.cpp
+++ b/src/x/wx_ipc.cpp
@@ -104,7 +104,7 @@
 #ifdef VMS
 int errno=0; // there is no defined global variable
 #else
-extern errno;
+#include <errno.h>
 #endif
 
 int wx_socket_create (int port);
@@ -424,7 +424,7 @@
 
     // Attempt to accept a socket connection on the given fd.
     // Args and return value are the same as connect(2).
-    int accept(int fd, struct sockaddr * addr, int * addrLen)
+    int accept(int fd, struct sockaddr * addr, socklen_t * addrLen)
     {
 	int rval = ::accept(fd, addr, addrLen);
 	if (rval > 0)
@@ -1126,7 +1126,8 @@
 #endif
 
   struct sockaddr_in addr;
-  int newsock, addrlen = sizeof (addr);
+  int newsock;
+  socklen_t addrlen = sizeof (addr);
   wxConnection *top_connection = (wxConnection *) client;
 
   /* Accept the connection, getting a new socket */
--- a/src/x/wx_rbox.cpp
+++ b/src/x/wx_rbox.cpp
@@ -282,7 +282,7 @@
 #endif
 						 NULL);
       XtAddCallback (radioButtons[i], XmNvalueChangedCallback, (XtCallbackProc) wxRadioBoxCallback,
-		     (XtCallbackProc) this);
+		     (void *) this);
 
       if (buttonFont)
 	XtVaSetValues (radioButtons[i],
@@ -1171,7 +1171,7 @@
 #endif
 						 NULL);
   XtAddCallback (radioButtonWidget, XmNvalueChangedCallback, (XtCallbackProc) wxRadioButtonCallback,
-		     (XtCallbackProc) this);
+		     (void *) this);
 
   if (labelFont)
    XtVaSetValues (radioButtonWidget,
--- a/src/x/wx_text.cpp
+++ b/src/x/wx_text.cpp
@@ -14,7 +14,11 @@
 #pragma implementation
 #endif
 
+#ifdef USE_IOSTREAMH
 #include <fstream.h>
+#else
+#include <fstream>
+#endif
 #include <stdio.h>
 #include <ctype.h>
 
@@ -58,7 +62,7 @@
 // New notify proc
 void wxTextWindowNotifyProc(Textsw textsw, Attr_avlist avlist);
 
-int wxMessageBox(char *message, char *caption, long style,
+int wxMessageBox(const char *message, const char *caption, long style,
                  wxWindow *parent, int x, int y);
 
 #endif
--- a/src/x/wx_txt.cpp
+++ b/src/x/wx_txt.cpp
@@ -606,12 +606,12 @@
 #endif
 }
 
-void wxText::SetValue (char *value)
+void wxText::SetValue (const char *value)
 {
 #ifdef wx_motif
   inSetValue = TRUE;
   if (value)
-    XmTextSetString ((Widget) handle, value);
+    XmTextSetString ((Widget) handle, (char *)value);
   inSetValue = FALSE;
 #endif
 #ifdef wx_xview
--- a/src/x/wx_utils.cpp
+++ b/src/x/wx_utils.cpp
@@ -36,7 +36,11 @@
 #pragma implementation "wx_utils.h"
 #endif
 
+#ifdef USE_IOSTREAMH
 #include <fstream.h>
+#else
+#include <fstream>
+#endif
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
--- a/src/x/wx_win.cpp
+++ b/src/x/wx_win.cpp
@@ -1385,7 +1385,7 @@
 #if DEBUG
 //  printf("Adding widget %ld, name = %s\n", w, win->GetClassInfo()->GetClassName());
 #endif
-  if (oldItem = (wxWindow *)wxWidgetHashTable->Get ((long) w))
+  if ((oldItem = (wxWindow *)wxWidgetHashTable->Get ((long) w)))
   {
     char buf[300];
     sprintf(buf, "Widget table clash: new widget is %ld, %s", (long)w, win->GetClassInfo()->GetClassName());
--- a/utils/dialoged/src/wx_rdlg.cpp
+++ b/utils/dialoged/src/wx_rdlg.cpp
@@ -30,7 +30,12 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+#endif
 #endif
 
 // #include "wx_scrol.h"
@@ -282,7 +287,7 @@
 
   wxMenu *menu = resourceManager->GetPopupMenu();
   menu->SetClientData((char *)item);
-#if 0 // wx_motif
+#ifdef NEVER // wx_motif
   handlerDialog->FakePopupMenu(menu, (float)x, (float)y);
 #else
   handlerDialog->PopupMenu(menu, (float)x, (float)y);
--- a/utils/dialoged/src/wx_repal.cpp
+++ b/utils/dialoged/src/wx_repal.cpp
@@ -30,7 +30,12 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+#endif
 #endif
 
 #include "wx_resed.h"
--- a/utils/dialoged/src/wx_resed.cpp
+++ b/utils/dialoged/src/wx_resed.cpp
@@ -43,7 +43,12 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+#endif
 #endif
 
 #include "wx_help.h"
@@ -517,7 +522,7 @@
     wxSDI | wxDEFAULT_FRAME);
 
   frame->CreateStatusLine(2);
-  frame->SetStatusText(editMode ? "Edit mode" : "Test mode", 1);
+  frame->SetStatusText((char *)(editMode ? "Edit mode" : "Test mode"), 1);
   frame->SetAutoLayout(TRUE);
 #ifdef wx_msw
   wxIcon *icon = new wxIcon("DIALOGEDICON");
@@ -1490,7 +1495,7 @@
 {
   editMode = flag;
   if (editorFrame)
-    editorFrame->SetStatusText(editMode ? "Edit mode" : "Test mode", 1);
+    editorFrame->SetStatusText((char *)(editMode ? "Edit mode" : "Test mode"), 1);
 
   // Switch mode for each dialog in the resource list
   resourceTable.BeginFind();
--- a/utils/dialoged/src/wx_reswr.cpp
+++ b/utils/dialoged/src/wx_reswr.cpp
@@ -31,7 +31,12 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+#endif
 #endif
 
 #include "wx_scrol.h"
--- a/utils/dialoged/src/wx_rprop.cpp
+++ b/utils/dialoged/src/wx_rprop.cpp
@@ -46,7 +46,12 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+#endif
 #endif
 
 #include "wx_resed.h"
@@ -127,12 +132,13 @@
   wxPropertyListDialog *propDialog = new wxPropertyListDialog(view, NULL, title, TRUE, x, y, width, height);
   
   wxPropertyValidatorRegistry theValidatorRegistry;
-  theValidatorRegistry.RegisterValidator((wxString)"real", new wxRealListValidator);
-  theValidatorRegistry.RegisterValidator((wxString)"string", new wxStringListValidator);
-  theValidatorRegistry.RegisterValidator((wxString)"integer", new wxIntegerListValidator);
-  theValidatorRegistry.RegisterValidator((wxString)"bool", new wxBoolListValidator);
-  theValidatorRegistry.RegisterValidator((wxString)"filename", new wxFilenameListValidator);
-  theValidatorRegistry.RegisterValidator((wxString)"stringlist", new wxListOfStringsListValidator);
+  wxString wxstr;
+  wxstr = "real"; theValidatorRegistry.RegisterValidator(wxstr, new wxRealListValidator);
+  wxstr = "string"; theValidatorRegistry.RegisterValidator(wxstr, new wxStringListValidator);
+  wxstr = "integer"; theValidatorRegistry.RegisterValidator(wxstr, new wxIntegerListValidator);
+  wxstr = "bool"; theValidatorRegistry.RegisterValidator(wxstr, new wxBoolListValidator);
+  wxstr = "filename"; theValidatorRegistry.RegisterValidator(wxstr, new wxFilenameListValidator);
+  wxstr = "stringlist"; theValidatorRegistry.RegisterValidator(wxstr, new wxListOfStringsListValidator);
 
 //  view->propertyWindow = propDialog;
   view->AddRegistry(&theValidatorRegistry);
--- a/utils/image/src/wx_image.cpp
+++ b/utils/image/src/wx_image.cpp
@@ -402,7 +402,7 @@
   i = strlen(fullname);
   if (i>2 && strcmp(fullname+i-2,".Z")==0) {
     strcpy(filename,"/tmp/xvXXXXXX");
-    mktemp(filename);
+    close(mkstemp(filename));
     sprintf(wxBuffer,"%s -c %s >%s",UNCOMPRESS,fullname,filename);
     if (system(wxBuffer)) {
       goto FAILED;
@@ -416,9 +416,9 @@
     FILE *fp;
 
     strcpy(filename,"/tmp/xvXXXXXX");
-    mktemp(filename);
-
-    fp = fopen(filename,"w");
+    int fd = mkstemp(filename);
+    if (!fd) perror ("Can't open temporary file");
+    fp = fdopen(fd,"w");
     if (!fp) FatalError("can't write /tmp/xv****** file");
     
     while ( (i=getchar()) != EOF) putc(i,fp);
--- a/utils/image/src/wx_imgx.h
+++ b/utils/image/src/wx_imgx.h
@@ -49,7 +49,7 @@
 #include <ctype.h>
 #include <string.h>
 extern int   errno;             /* this SHOULD be in errno.h */
-#ifndef __FreeBSD__
+#if !(defined __GLIBC__ && __GLIBC__ >=2)
 extern char *sys_errlist[];     /* this SHOULD be in errno.h */
 #endif
 
--- a/utils/prologio/src/prorpc.cpp
+++ b/utils/prologio/src/prorpc.cpp
@@ -30,7 +30,12 @@
 #ifdef wx_msw
 #include <strstrea.h>
 #else
+#if USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+using std::ostrstream;
+#endif
 #endif
 #include <ctype.h>
 #include "prorpc.h"
--- a/utils/prologio/src/prorpc.h
+++ b/utils/prologio/src/prorpc.h
@@ -57,7 +57,7 @@
 {
   DECLARE_CLASS(rpcServer)
  public:
-  rpcServer::rpcServer(void);
+  rpcServer(void);
   wxConnection *OnAcceptConnection(char *topic);
 };
 
@@ -65,7 +65,7 @@
 {
   DECLARE_CLASS(rpcClient)
  public:
-  rpcClient::rpcClient(void);
+  rpcClient(void);
   wxConnection *OnMakeConnection(void);
 };
 
--- a/utils/prologio/src/read.cpp
+++ b/utils/prologio/src/read.cpp
@@ -1343,7 +1343,7 @@
   for (;;)
   {
     PrologExpr *object = va_arg(ap, PrologExpr *);
-    if (((int)object) == 0)
+    if (!object)
       break;
     else
       clause->Append(object);
@@ -1444,7 +1444,7 @@
         return copystring("Too many arguments");
       }
 
-      int object_int = (int)(type_node->Data());
+      long int object_int = (long int)(type_node->Data());
       PrologType object = (PrologType)object_int;
 
       if (argument->Type() != object)
--- a/utils/tex2rtf/src/table.cpp
+++ b/utils/tex2rtf/src/table.cpp
@@ -15,13 +15,15 @@
 #include <wx.h>
 #endif
 
+#include <wx_setup.h>
 #include <wx_hash.h>
 #if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
 #endif
-#include <fstream.h>
 #include <ctype.h>
 #include "tex2any.h"
 #include "table.h"
--- a/utils/tex2rtf/src/tex2rtf.cpp
+++ b/utils/tex2rtf/src/tex2rtf.cpp
@@ -38,12 +38,19 @@
 #include <wx.h>
 #endif
 
+#include <wx_setup.h>
 #ifndef NO_GUI
 #include <wx_help.h>
 #include <wx_timer.h>
 #endif
 #ifdef NO_GUI
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <iostream.h>
+#else
+#include <iostream>
+using std::cout;
+using std::cerr;
+#endif
 #endif
 
 #include <ctype.h>
--- a/utils/tex2rtf/src/texutils.cpp
+++ b/utils/tex2rtf/src/texutils.cpp
@@ -15,13 +15,20 @@
 #include <wx.h>
 #endif
 
+#include <wx_setup.h>
 #include <wx_hash.h>
 #if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <iostream.h>
+#include <fstream.h>
 #else
 #include <iostream>
+#include <fstream>
+using std::istream;
+using std::ostream;
+using std::ifstream;
+using std::ofstream;
+using std::ios;
 #endif
-#include <fstream.h>
 #include <ctype.h>
 #include "tex2any.h"
 
@@ -390,7 +397,11 @@
 
 void ReadTexReferences(char *filename)
 {
-  ifstream istr(filename, ios::nocreate | ios::in);
+  ifstream istr(filename,
+#if GCC_VERSION < 30200
+		ios::nocreate |
+#endif
+		ios::in);
   if (istr.bad()) return;
 
   char label[100];
@@ -554,7 +565,11 @@
 Bool ReadBib(char *filename)
 {
   char buf[300];
-  ifstream istr(filename, ios::nocreate | ios::in);
+  ifstream istr(filename,
+#if GCC_VERSION < 30200
+		ios::nocreate |
+#endif
+		ios::in);
   if (istr.bad()) return FALSE;
 
   BibLine = 1;
@@ -1271,7 +1286,11 @@
 
 Bool ReadCustomMacros(char *filename)
 {
-  ifstream istr(filename, ios::nocreate | ios::in);
+  ifstream istr(filename,
+#if GCC_VERSION < 30200
+		ios::nocreate |
+#endif
+		ios::in);
   if (istr.bad()) return FALSE;
 
   CustomMacroList.Clear();
--- a/utils/tex2rtf/src/wxwin/wb_hash.cpp
+++ b/utils/tex2rtf/src/wxwin/wb_hash.cpp
@@ -28,7 +28,7 @@
 
 #include "wx_hash.h"
 
-#include <iostream.h>
+//#include <iostream.h>
 #include <string.h>
 #include <stdarg.h>
 
--- a/utils/tex2rtf/src/wxwin/wb_list.cpp
+++ b/utils/tex2rtf/src/wxwin/wb_list.cpp
@@ -177,7 +177,7 @@
   {
     wxObject *object = va_arg(ap, wxObject *);
 //    if (object == NULL) // Doesn't work in Windows -- segment is non-zero for NULL!
-    if ((int)object == 0)
+    if (!object)
       break;
     else
       { wxNode *node = new wxNode(this, last, NULL, object);
@@ -402,7 +402,7 @@
   {
     char *s = va_arg(ap, char *);
 //    if (s == NULL)
-    if ((int)s == 0)
+    if (!s)
       break;
     else
       { wxNode *node = new wxNode(this, last, NULL, (wxObject *)copystring(s));
--- a/utils/tex2rtf/src/wxwin/wb_utils.cpp
+++ b/utils/tex2rtf/src/wxwin/wb_utils.cpp
@@ -31,8 +31,15 @@
 #include "wx_utils.h"
 #include "wx_list.h"
 
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <iostream.h>
 #include <fstream.h>
+#else
+#include <iostream>
+#include <fstream>
+using std::cerr;
+#endif
 #include <ctype.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -162,7 +169,7 @@
     if (exact)
       found = (strcmp(oneUpper, twoUpper) == 0);
     else
-      found = (strncmp(oneUpper, twoUpper, min(lenOne, lenTwo)) == 0);
+      found = (strncmp(oneUpper, twoUpper, (lenOne < lenTwo ? lenOne : lenTwo)) == 0);
   }
 
   delete[] oneUpper;
--- a/utils/wxbuild/src/bactions.cpp
+++ b/utils/wxbuild/src/bactions.cpp
@@ -102,9 +102,9 @@
     listExpr->Append(new PrologExpr(actionWindow->id));
   else
     listExpr->Append(new PrologExpr((long)-1));
-  listExpr->Append(new PrologExpr(PrologString, (filename ? filename : "")));
-  listExpr->Append(new PrologExpr(PrologString, (stringArg1? stringArg1: "")));
-  listExpr->Append(new PrologExpr(PrologString, (stringArg2? stringArg2: "")));
+  listExpr->Append(new PrologExpr(PrologString, (char *)(filename ? filename : "")));
+  listExpr->Append(new PrologExpr(PrologString, (char *)(stringArg1? stringArg1: "")));
+  listExpr->Append(new PrologExpr(PrologString, (char *)(stringArg2? stringArg2: "")));
   listExpr->Append(new PrologExpr(integerArg1));
   listExpr->Append(new PrologExpr(integerArg2));
 }
@@ -552,7 +552,7 @@
       stream << indentation << "  theApp." << actionWindow->name << " = \n";
       stream << indentation;
       actionWindow->GenerateConstructorCall(stream,
-         (actionWindow->buildParent ? actionWindow->buildParent->name : "NULL"));
+         (char *)(actionWindow->buildParent ? actionWindow->buildParent->name : "NULL"));
       stream << ";\n";
       if (buildApp.useResourceMethod && ((actionWindow->windowType == wxTYPE_PANEL) || actionWindow->windowType == wxTYPE_DIALOG_BOX))
       {
--- a/utils/wxbuild/src/bgdi.cpp
+++ b/utils/wxbuild/src/bgdi.cpp
@@ -630,7 +630,7 @@
 
 Bool BuildBitmapData::Edit(wxWindow *parent)
 {
-  wxDialogBox *dialog = new wxDialogBox(parent, (bitmapIsIcon ? "Choosing Icon" : "Choosing Bitmap"), TRUE, 10, 10);
+  wxDialogBox *dialog = new wxDialogBox(parent, (char *)(bitmapIsIcon ? "Choosing Icon" : "Choosing Bitmap"), TRUE, 10, 10);
   dialog->SetLabelFont(SmallLabelFont);
   dialog->SetButtonFont(SmallButtonFont);
 
--- a/utils/wxchart/src/lbchart.cpp
+++ b/utils/wxchart/src/lbchart.cpp
@@ -239,11 +239,11 @@
 }
 void wxChartLayout::DrawBars(int a)
 {          	                      
-	int row = dataSetArray[a]->GetRowNo();
+	long int row = dataSetArray[a]->GetRowNo();
 	if(row<0) 
 	{
 		wxNode *node = dataSetArray[a]->rowsList->First();
-		row = (int)node->Data();
+		row = (long int)node->Data();
 	}		
 	for(int i=startCol; i<=endCol; i++)
 			DrawBar(i,row);	   
@@ -295,11 +295,11 @@
 }         
                   
 void wxChartLayout::DrawBarFloating(int a)
-{ int row2=-1,row=-1;
+{ long int row2=-1,row=-1;
 	wxNode *node = dataSetArray[a]->rowsList->First();
-	row = (int)node->Data();	
+	row = (long int)node->Data();	
 	node = node->Next();
-	row2 = (int)node->Data();
+	row2 = (long int)node->Data();
 
 	chartDC->BeginDrawing();   		                            	
 	if (chartDC && row!=-1 && row!=-1)
@@ -331,18 +331,19 @@
 
 void wxChartLayout::DrawLine(int a)
 {	float x,y;                      
-	int row = dataSetArray[a]->GetRowNo();
+	long int row = dataSetArray[a]->GetRowNo();
 	if(row<0) 
 	{
 		wxNode *node = dataSetArray[a]->rowsList->First();
-		row = (int)node->Data();
+		row = (long int)node->Data();
 	}		
 	if(chartDC)
 	{
 		wxPoint points[MAXCOLS];;
 		if(orientation==wxVERTICAL)
 		{
-			for(int i=startCol; i<=endCol; i++)                                         
+			int i;
+			for(i=startCol; i<=endCol; i++)
 			{
 				points[i].x = left + ( (colWidth + colSpace) * i) + (colWidth/2);
 				points[i].y =  bottom - ( GetData(i,row) * stepSize);
@@ -351,7 +352,8 @@
 		}
 		else if (orientation==wxHORIZONTAL)
 		{                                 
-			for(int i=startCol; i<=endCol; i++)                                         
+			int i;
+			for(i=startCol; i<=endCol; i++)
 			{
 				points[i].y = top + ( (colWidth + colSpace) * i) + (colWidth/2);
 				points[i].x = left + ( GetData(i,row) * stepSize);	
@@ -363,11 +365,11 @@
 
 void wxChartLayout::DrawCurve(int a)
 { 
-	int row = dataSetArray[a]->GetRowNo();
+	long int row = dataSetArray[a]->GetRowNo();
 	if(row<0) 
 	{
 		wxNode *node = dataSetArray[a]->rowsList->First();
-		row = (int)node->Data();
+		row = (long int)node->Data();
 	}		
 	if(chartDC)
 	{ float x,y;
@@ -405,7 +407,7 @@
 	if(row<0) 
 	{
 		wxNode *node = dataSetArray[a]->rowsList->First();
-		row = (int)node->Data();
+		row = (long int)node->Data();
 	}		
 	if(chartDC)
 	{ 
@@ -442,7 +444,7 @@
 	if(row<0) 
 	{
 		wxNode *node = dataSetArray[a]->rowsList->First();
-		row = (int)node->Data();
+		row = (long int)node->Data();
 	}		    
 	if(chartDC)
 	{
@@ -451,7 +453,8 @@
 		{
 			points[s].x = left + (colWidth/2);
 			points[s].y = bottom;			
-			for(int i=startCol, s=1 ; i<=endCol+1; s++, i++)                                         
+			int i;
+			for(i=startCol, s=1 ; i<=endCol+1; s++, i++)
 			{
 				points[s].x = left + ( (colWidth + colSpace) * i) + (colWidth/2);
 				points[s].y = bottom - (GetData(i,row) * stepSize);	
@@ -466,7 +469,8 @@
 		{  
 			points[s].x = left;
 			points[s].y = top;
-			for(int i=startCol, s=1; i<=endCol+1; i++, s++)                                         
+			int i;
+			for(i=startCol, s=1; i<=endCol+1; i++, s++)
 			{
 				points[s].y = top + ( (colWidth + colSpace) * i) + (colWidth/2);
 				points[s].x = left + ( GetData(i,row) * stepSize);	
@@ -494,10 +498,11 @@
 		sum = 0; val = 0.0; x = 0; 
 		if(orientation==wxVERTICAL) oldh = bottom;
 		else if(orientation==wxHORIZONTAL) oldh = left;
-		row = (int)node->Data();
+		row = (long int)node->Data();
 		
 		// Find the sum of all values in this row ( to be bar).	
-		for (int i = startCol; i<=endCol; i++){	val = GetData(i,row);	sum = sum + val;}		                    
+		int i;
+		for (i = startCol; i<=endCol; i++){	val = GetData(i,row);	sum = sum + val;}
 	
 		for (i = startCol; i<=endCol; i++)
 		{	
@@ -567,9 +572,9 @@
 			 "VIOLET","YELLOW","WHEAT","SLATE BLUE"};
 	wxBrush *brush;												 
   float radius = (maxWidth)/4;         
-	int val, fromx=0,fromy=0, tox, toy, sum = 0;  
+	int i, val, fromx=0,fromy=0, tox, toy, sum = 0;  
 	float toAngle=0.0;
-	for (int i = startCol; i<=endCol; i++)
+	for (i = startCol; i<=endCol; i++)
 	{	val = GetData(i,row);		
 		sum = sum + val;
 	}	
--- a/utils/wxprop/src/wx_pform.cpp
+++ b/utils/wxprop/src/wx_pform.cpp
@@ -30,7 +30,7 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
-#include <strstream.h>
+//#include <strstream.h>
 #endif
 
 #include "wx_win.h"
--- a/utils/wxprop/src/wx_plist.cpp
+++ b/utils/wxprop/src/wx_plist.cpp
@@ -30,7 +30,7 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
-#include <strstream.h>
+//#include <strstream.h>
 #endif
 
 #include "wx_win.h"
--- a/utils/wxprop/src/wx_prop.cpp
+++ b/utils/wxprop/src/wx_prop.cpp
@@ -30,7 +30,13 @@
 #if defined(wx_msw) && !defined(GNUWIN32)
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+using std::ostrstream;
+#endif
 #endif
 
 #include "wx_win.h"
--- a/utils/wxtree/src/wxtree.h
+++ b/utils/wxtree/src/wxtree.h
@@ -71,7 +71,7 @@
   inline float GetLeftMargin(void) { return leftMargin; }
 
   inline Bool GetOrientation(void) { return orientation; }
-  inline void SetOrientation(Bool or) { orientation = or; }
+  inline void SetOrientation(Bool or_) { orientation = or_; }
  private:
   void CalcLayout(long node_id, int level);
 };
--- a/utils/wxweb/src/Makefile.in
+++ b/utils/wxweb/src/Makefile.in
@@ -23,8 +23,7 @@
 #
 CXXSRCS = wxwww.$(SRCSUFF) wxhtml.$(SRCSUFF) htmldraw.$(SRCSUFF) \
 	htmlpars.$(SRCSUFF) htmlmisc.$(SRCSUFF) htmlform.$(SRCSUFF) \
-	htmltab2.$(SRCSUFF) htmltabl.$(SRCSUFF) \
-	simsock.$(SRCSUFF) listof.$(SRCSUFF) \
+	htmltabl.$(SRCSUFF) simsock.$(SRCSUFF) listof.$(SRCSUFF) \
 	authent.$(SRCSUFF) base64.$(SRCSUFF) htmlfram.$(SRCSUFF) \
 	popmail.$(SRCSUFF) htmlsite.$(SRCSUFF) astring.$(SRCSUFF) \
 	smtpmail.$(SRCSUFF) htmledit.$(SRCSUFF) sslsock.$(SRCSUFF) \
--- a/utils/wxweb/src/astring.cpp
+++ b/utils/wxweb/src/astring.cpp
@@ -23,7 +23,7 @@
 #include <ctype.h>
 #pragma hdrstop
 
-const DLE = 0x10;
+const int DLE = 0x10;
 
 string string::nil("");
 const size_t string::npos = (size_t)-1;
@@ -518,7 +518,11 @@
 
 istream& operator>>(istream& istr, string& s)
 {
-  if (!istr.ipfx(0) || (!(istr.flags() & ios::skipws) && !ws(istr)))
+  if (
+#if GCC_VERSION < 30200
+      !istr.ipfx(0) ||
+#endif
+      (!(istr.flags() & ios::skipws) && !ws(istr)))
   {
 	 istr.clear(ios::failbit|istr.rdstate()); // Redundant if using GNU iostreams.
 	 return istr;
@@ -526,7 +530,7 @@
 
   int ch;
   size_t i = 0;
-  const BLOCK_SIZE = 256;
+  const int BLOCK_SIZE = 256;
   char* block = (char*)malloc(BLOCK_SIZE);
   size_t nbytes = BLOCK_SIZE;
 
@@ -548,7 +552,7 @@
   int new_state = istr.rdstate();
   if (i == 0) new_state |= ios::failbit;
   if (ch == EOF) new_state |= ios::eofbit;
-  istr.clear(new_state);
+  istr.clear((std::_Ios_Iostate)new_state);
 
   s = string(block, 0, i);
   free(block);
--- a/utils/wxweb/src/astring.h
+++ b/utils/wxweb/src/astring.h
@@ -25,7 +25,21 @@
 #else
 
 #include <string.h>
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <iostream.h>
+#else
+#include <iostream>
+#include <istream>
+#include <fstream>
+#include <iosfwd>
+#include <streambuf>
+using std::ifstream;
+using std::istream;
+using std::ostream;
+using std::ios;
+using std::streambuf;
+#endif
 #include <limits.h>
 
 class string
--- a/utils/wxweb/src/authent.cpp
+++ b/utils/wxweb/src/authent.cpp
@@ -28,7 +28,13 @@
 #ifdef _MSC_VER
 #include <strstrea.h>
 #else
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
 #include <strstream.h>
+#else
+#include <strstream>
+using std::strstream;
+#endif
 #endif
 
 #include "wxhtml.h"
--- a/utils/wxweb/src/base64.cpp
+++ b/utils/wxweb/src/base64.cpp
@@ -1,6 +1,6 @@
 // base64.cpp - written and placed in the public domain by Wei Dai
 
-#include <iostream.h>
+//#include <iostream.h>
 
 #include "astring.h"
 #include "base64.h"
--- a/utils/wxweb/src/htmlconf.h
+++ b/utils/wxweb/src/htmlconf.h
@@ -94,31 +94,31 @@
 #endif
 
 #ifndef TAB_SIZE
-const TAB_SIZE = 4;
+const int TAB_SIZE = 4;
 #endif
 
 #ifndef MAX_TABS
-const MAX_TABS = 16;
+const int MAX_TABS = 16;
 #endif
 
-const SCROLLBAR_WIDTH = 20;        // What is it really
-const VSCROLL_INCREMENT = 50;
+const int SCROLLBAR_WIDTH = 20;        // What is it really
+const int VSCROLL_INCREMENT = 50;
 
 // Probably won't need to change this...
 
-const HTML_COPY = 100;
-const HTML_CUT = 101;
-const HTML_PASTE = 102;
-const HTML_PROPERTIES = 103;
-const HTML_BACK = 104;
-const HTML_EDIT = 105;
-const HTML_BOLD = 106;
-const HTML_ITALIC = 107;
-const HTML_UNDERLINE = 108;
-const HTML_STRIKE = 109;
-const HTML_FIXED = 110;
-const HTML_PLUS = 111;
-const HTML_MINUS = 112;
+const int HTML_COPY = 100;
+const int HTML_CUT = 101;
+const int HTML_PASTE = 102;
+const int HTML_PROPERTIES = 103;
+const int HTML_BACK = 104;
+const int HTML_EDIT = 105;
+const int HTML_BOLD = 106;
+const int HTML_ITALIC = 107;
+const int HTML_UNDERLINE = 108;
+const int HTML_STRIKE = 109;
+const int HTML_FIXED = 110;
+const int HTML_PLUS = 111;
+const int HTML_MINUS = 112;
 
 #endif
 
--- a/utils/wxweb/src/htmlpars.cpp
+++ b/utils/wxweb/src/htmlpars.cpp
@@ -33,7 +33,7 @@
 #include "htmlpars.h"
 
 const float TEXT_FACTOR = 1.0F;
-const ADJUST = 2;
+const int ADJUST = 2;
 
 static char buf[1024*4];
 static char tag[1024*31];		      // Has to be big for comments
--- a/utils/wxweb/src/htmlsite.cpp
+++ b/utils/wxweb/src/htmlsite.cpp
@@ -51,7 +51,7 @@
 static ListOf attributes, values;
 
 #define SHOW_OBJECTS 0
-const LIST_TYPE = 2;
+const int LIST_TYPE = 2;
 
 ///////////////////////////////////////////////////////////////////////////////
 
--- a/utils/wxweb/src/htmltabl.cpp
+++ b/utils/wxweb/src/htmltabl.cpp
@@ -713,11 +713,11 @@
 
 static void DrawBorder(wxDC* dc, float x, float y, float w, float h, float bw, Bool raised)
 {
-	dc->SetPen(wxThePenList->FindOrCreatePen(raised?"WHITE":"GREY", (int)bw, wxSOLID));
+	dc->SetPen(wxThePenList->FindOrCreatePen((char *)(raised?"WHITE":"GREY"), (int)bw, wxSOLID));
 	dc->DrawLine(x, y, x, y+h);
 	dc->DrawLine(x, y, x+w, y);
 
-	dc->SetPen(wxThePenList->FindOrCreatePen(raised?"GREY":"WHITE", (int)bw, wxSOLID));
+	dc->SetPen(wxThePenList->FindOrCreatePen((char *)(raised?"GREY":"WHITE"), (int)bw, wxSOLID));
 	dc->DrawLine(x, y+h, x+w, y+h);
 	dc->DrawLine(x+w, y, x+w, y+h);
 }
--- a/utils/wxweb/src/http.cpp
+++ b/utils/wxweb/src/http.cpp
@@ -12,7 +12,23 @@
 
 #include <stdio.h>
 #include <stdlib.h>
+#include <wx_setup.h>
+#include <wx_hash.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
+#include <iostream.h>
 #include <fstream.h>
+#else
+#include <iostream>
+#include <istream>
+#include <ostream>
+#include <fstream>
+#include <iosfwd>
+using std::ifstream;
+using std::ofstream;
+using std::ostream;
+using std::ios;
+using std::endl;
+#endif
 #include <ctype.h>
 #include <sys/stat.h>
 
@@ -74,9 +90,9 @@
 static SockClient dummy_sock;
 static unsigned instance_count = 0;
 const char* version = "2.17";
-const BUFFER_SIZE = 4096;
+const int BUFFER_SIZE = 4096;
 
-ofstream log;
+ofstream log_;
 
 //////////////////////////////////////////////////////////////
 // Timestamp io-manipulator...
@@ -328,9 +344,9 @@
 			  (connection->max_conns <= 0) ) )
 		{
 			if (!connection->max_conns)
-				log << connection->nbr << ts << "Kill limited connection" << endl;
+				log_ << connection->nbr << ts << "Kill limited connection" << endl;
 			else
-				log << connection->nbr << ts << "Kill timed connection" << endl;
+				log_ << connection->nbr << ts << "Kill timed connection" << endl;
 
 			connection->GetSock()->Close();
 		}
@@ -338,7 +354,7 @@
 		if (connection->GetSock()->WaitForError(0) ||
 				!connection->GetSock()->IsConnected())
 		{
-			log << connection->nbr << ts << "Close connection" << endl;
+			log_ << connection->nbr << ts << "Close connection" << endl;
 			delete connection;
 			ilist.Delete();
 		}
@@ -392,7 +408,7 @@
 				was_secure = 0;
 		}
 
-		//log << ts << "LOADING: " << filename << " <= " << localname << endl;
+		//log_ << ts << "LOADING: " << filename << " <= " << localname << endl;
 
 		if (!inline_object) current_server = "Cached";
 
@@ -433,7 +449,7 @@
 		else
 			sprintf(tmp, "%s/%s", path, filename.data());
 
-		log << ts << "LOADING: " << filename << endl;
+		log_ << ts << "LOADING: " << filename << endl;
 		localname = tmp;
 
 		return 1;
@@ -517,7 +533,7 @@
 			);
 
 		OnSetStatusText(tmp);
-		log << nbr << ts << "CONNECT: " << which_host << ", Port: " << which_port << endl;
+		log_ << nbr << ts << "CONNECT: " << which_host << ", Port: " << which_port << endl;
 
 #if USE_SSL
 		if (https)
@@ -547,7 +563,7 @@
 			string s = "Unreachable: ";
 			s += hostname;
 			OnSetStatusText(s.data());
-			log << ts << s << endl;
+			log_ << ts << s << endl;
 			delete sock;
 			return 0;
 		}
@@ -559,7 +575,7 @@
 
 	sprintf(tmp, "Requesting: %s", new_url.data());
 	OnSetStatusText(tmp);
-	log << nbr << ts << tmp << endl;
+	log_ << nbr << ts << tmp << endl;
 
 	char* dst = tmp;
 
@@ -688,7 +704,7 @@
 	}
 
 	if (post)
-		log << nbr << ts << "POST: " << data << endl;
+		log_ << nbr << ts << "POST: " << data << endl;
 
 	sprintf(dst, "\n");		// Ends request...
 
@@ -768,7 +784,7 @@
 		if (tmp[len-1] == '\r') len--;
 		tmp[len] = 0;
 
-		log << nbr << ts << "GOT: " << tmp << endl;
+		log_ << nbr << ts << "GOT: " << tmp << endl;
 
 		static char status[1024], status2[1024];
 		status[0] = status2[0] = 0;
@@ -1132,7 +1148,7 @@
 	sprintf(tmp, "Received: %.1fK bytes", (float)nbytes/1024);
 	OnSetStatusText(tmp);
 
-	log << nbr << ts << "RECEIVED: " << nbytes << " bytes in " << (time(0)-started) << " secs" << endl;
+	log_ << nbr << ts << "RECEIVED: " << nbytes << " bytes in " << (time(0)-started) << " secs" << endl;
 
 	if (cancel || (length_specified && length))
 	{
@@ -1140,7 +1156,7 @@
 		{
 			sprintf(tmp, "ERROR: left-over bytes = %ld", length);
 			OnSetStatusText(tmp);
-			log << nbr << ts << tmp << endl << endl;
+			log_ << nbr << ts << tmp << endl << endl;
 		}
 
 		remove(localname.data());
@@ -1174,14 +1190,14 @@
 
 	if (!keep_alive && new_sock)
 	{
-		log << "-" << ts << "Drop new connection" << endl;
+		log_ << "-" << ts << "Drop new connection" << endl;
 		delete sock;
 		sock = 0;
 	}
 
 	if (!keep_alive && connection)
 	{
-		log << connection->nbr << ts << "Drop old connection, why?" << endl;
+		log_ << connection->nbr << ts << "Drop old connection, why?" << endl;
 		delete connection;
 		connection = 0;
 		ilist.Delete();
--- a/utils/wxweb/src/popmail.cpp
+++ b/utils/wxweb/src/popmail.cpp
@@ -19,7 +19,7 @@
 
 #include <stdio.h>
 #include <string.h>
-#include <fstream.h>
+//#include <fstream.h>
 
 #include "popmail.h"
 
--- a/utils/wxweb/src/simsock.cpp
+++ b/utils/wxweb/src/simsock.cpp
@@ -50,7 +50,7 @@
 #ifdef _sgi
 #include <bstring.h>
 #endif
-#ifdef sparc
+#if defined(sparc) && !defined(linux)
 #include <sys/filio.h>
 #endif
 
@@ -69,7 +69,7 @@
 #define EINTR WSAEINTR
 #endif
 
-const DLE = 0x10;
+const int DLE = 0x10;
 
 #ifdef _Windows
 // This is an MS TCP/IP routine and is not needed here. Some WinSock
@@ -193,7 +193,7 @@
 #endif
 #endif
 
-#ifdef __sgi
+#if defined(__sgi) || defined(linux)
 		act.sa_handler = (void (*)(int)) SIG_IGN;
 #else
 		act.sa_handler = (void (*)(... )) SIG_IGN;
--- a/utils/wxweb/src/simsock.h
+++ b/utils/wxweb/src/simsock.h
@@ -105,7 +105,12 @@
 
 ////////////////////////////////////////////////////////////////////////
 
-struct fd_set;
+#include <features.h>
+#if defined __GLIBC__ && __GLIBC__ >=2
+#include <sys/types.h>
+#else
+#include <linux/types.h>
+#endif
 class ListOf;
 class ListOfIterator;
 
--- a/utils/wxweb/src/smtpmail.cpp
+++ b/utils/wxweb/src/smtpmail.cpp
@@ -17,7 +17,21 @@
 //
 ///////////////////////////////////////////////////////////////////////////////
 
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
+#include <iostream.h>
 #include <fstream.h>
+#else
+#include <iostream>
+#include <istream>
+#include <fstream>
+#include <iosfwd>
+using std::istream;
+using std::ostream;
+using std::ifstream;
+using std::ofstream;
+using std::ios;
+#endif
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
@@ -424,7 +438,11 @@
 #ifdef _Windows
 		ifstream istr(attached_filename, ios::in|ios::nocreate|ios::binary);
 #else
-		ifstream istr(attached_filename, ios::in|ios::nocreate);
+		ifstream istr(attached_filename, ios::in
+#if GCC_VERSION <30200
+			      |ios::nocreate
+#endif
+			      );
 #endif
 
 		if (!strncmp(mime_type, "text/", 5))
@@ -456,7 +474,7 @@
 
 	// The preamble...
 
-	sprintf(buf,"Content-Type: multipart/mixed; boundary=\"%s\"\r\nContent-Length: %ld\r\n\r\n", boundary, ostr.tellp()+5);
+	sprintf(buf,"Content-Type: multipart/mixed; boundary=\"%s\"\r\nContent-Length: %ld\r\n\r\n", boundary, ((int)ostr.tellp())+5);
 	Write(buf, strlen(buf));
 
 	return 1;
--- a/utils/wxweb/src/wxhtml.cpp
+++ b/utils/wxweb/src/wxhtml.cpp
@@ -69,7 +69,7 @@
 static wxTextWindow* console = 0;
 extern const char* version;
 
-const MAX_REQUESTS = 4;
+const int MAX_REQUESTS = 4;
 static int max_reqs = MAX_REQUESTS;
 
 ///////////////////////////////////////////////////////////////////////////////
@@ -971,7 +971,11 @@
 	filename = filename.replace("|", "");
 #endif
 
-	ifstream istr(filename.data(), ios::in|ios::nocreate);
+	ifstream istr(filename.data(), ios::in
+#if GCC_VERSION < 30200
+		      |ios::nocreate
+#endif
+		      );
 
 	if (!istr)
 	{
--- a/utils/wxweb/src/wxhtml.h
+++ b/utils/wxweb/src/wxhtml.h
@@ -82,7 +82,7 @@
 	int Back(int cnt=1);
 	int SaveFile(const string& filename);
 	int SaveGeneratedFile(const string& filename);
-	virtual PutGenerated();
+	virtual int PutGenerated();
 	void Parse(wxDC* dc);
 	int Stop();
 	virtual void Reload(Bool /*from_host*/=FALSE);
@@ -406,7 +406,7 @@
 	struct Deferral
 	{
 		string srcname, dynsrc, soundname;
-		wxHtml* wxHtml;
+		wxHtml* wxHtml_;
 		float x, y, w, h;
 	};
 	ListOf deferrals_lo;
--- a/utils/wxweb/src/wxwww.cpp
+++ b/utils/wxweb/src/wxwww.cpp
@@ -28,7 +28,21 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <time.h>
+#include <wx_setup.h>
+#if !defined(USE_IOSTREAMH) || USE_IOSTREAMH
+#include <iostream.h>
 #include <fstream.h>
+#else
+#include <iostream>
+#include <istream>
+#include <ostream>
+#include <fstream>
+#include <iosfwd>
+using std::ifstream;
+using std::ofstream;
+using std::ios;
+using std::endl;
+#endif
 #include <sys/stat.h>
 #include <limits.h>
 
@@ -162,7 +176,11 @@
 
 void wxWWW::LoadFiles()
 {
-	ifstream cachefile((cache_path + SEP + CACHEFILE).data(), ios::in|ios::nocreate);
+	ifstream cachefile((cache_path + SEP + CACHEFILE).data(), ios::in 
+#if GCC_VERSION < 30200
+			   |ios::nocreate
+#endif
+			   );
 	char buf[256];
 
 	while (cachefile && !cachefile.get(buf, sizeof(buf)).eof())
@@ -183,7 +201,11 @@
 		cachefile.get();			// skip the LF
 	}
 
-	ifstream mapfile((cwd_path + SEP + MAPFILE).data(), ios::in|ios::nocreate);
+	ifstream mapfile((cwd_path + SEP + MAPFILE).data(), ios::in
+#if GCC_VERSION < 30200
+			 |ios::nocreate
+#endif
+			 );
 
 	while (mapfile && !mapfile.get(buf, sizeof(buf)).eof())
 	{
--- a/utils/wxweb/src/wxwww.h
+++ b/utils/wxweb/src/wxwww.h
@@ -77,7 +77,7 @@
 	Bool VerifyWeb(const string&, wxHtml*);
 	void DoYield() const { wxYield(); };
 
-	static persistent_cache;
+	static int persistent_cache;
 	static string cwd_path;
 };
 
